{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2022 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.serializeOrigin = exports.BrowsingContextImpl = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst assert_js_1 = require(\"../../../utils/assert.js\");\nconst Deferred_js_1 = require(\"../../../utils/Deferred.js\");\nconst log_js_1 = require(\"../../../utils/log.js\");\nconst unitConversions_js_1 = require(\"../../../utils/unitConversions.js\");\nconst WindowRealm_js_1 = require(\"../script/WindowRealm.js\");\nclass BrowsingContextImpl {\n  static LOGGER_PREFIX = `${log_js_1.LogType.debug}:browsingContext`;\n  /** The ID of this browsing context. */\n  #id;\n  userContext;\n  /**\n   * The ID of the parent browsing context.\n   * If null, this is a top-level context.\n   */\n  #parentId;\n  /** Direct children browsing contexts. */\n  #children = new Set();\n  #browsingContextStorage;\n  #lifecycle = {\n    DOMContentLoaded: new Deferred_js_1.Deferred(),\n    load: new Deferred_js_1.Deferred()\n  };\n  #navigation = {\n    withinDocument: new Deferred_js_1.Deferred()\n  };\n  #url = 'about:blank';\n  #eventManager;\n  #realmStorage;\n  #loaderId;\n  #cdpTarget;\n  #maybeDefaultRealm;\n  #logger;\n  // Keeps track of the previously set viewport.\n  #previousViewport = {\n    width: 0,\n    height: 0\n  };\n  constructor(id, parentId, userContext, cdpTarget, eventManager, browsingContextStorage, realmStorage, logger) {\n    this.#cdpTarget = cdpTarget;\n    this.#id = id;\n    this.#parentId = parentId;\n    this.userContext = userContext;\n    this.#eventManager = eventManager;\n    this.#browsingContextStorage = browsingContextStorage;\n    this.#realmStorage = realmStorage;\n    this.#logger = logger;\n  }\n  static create(id, parentId, userContext, cdpTarget, eventManager, browsingContextStorage, realmStorage, logger) {\n    const context = new BrowsingContextImpl(id, parentId, userContext, cdpTarget, eventManager, browsingContextStorage, realmStorage, logger);\n    context.#initListeners();\n    browsingContextStorage.addContext(context);\n    if (!context.isTopLevelContext()) {\n      context.parent.addChild(context.id);\n    }\n    eventManager.registerEvent({\n      type: 'event',\n      method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,\n      params: context.serializeToBidiValue()\n    }, context.id);\n    return context;\n  }\n  static getTimestamp() {\n    // `timestamp` from the event is MonotonicTime, not real time, so\n    // the best Mapper can do is to set the timestamp to the epoch time\n    // of the event arrived.\n    // https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-MonotonicTime\n    return new Date().getTime();\n  }\n  /**\n   * @see https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\n   */\n  get navigableId() {\n    return this.#loaderId;\n  }\n  dispose() {\n    this.#deleteAllChildren();\n    this.#realmStorage.deleteRealms({\n      browsingContextId: this.id\n    });\n    // Remove context from the parent.\n    if (!this.isTopLevelContext()) {\n      this.parent.#children.delete(this.id);\n    }\n    // Fail all ongoing navigations.\n    this.#failLifecycleIfNotFinished();\n    this.#eventManager.registerEvent({\n      type: 'event',\n      method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.ContextDestroyed,\n      params: this.serializeToBidiValue()\n    }, this.id);\n    this.#browsingContextStorage.deleteContextById(this.id);\n  }\n  /** Returns the ID of this context. */\n  get id() {\n    return this.#id;\n  }\n  /** Returns the parent context ID. */\n  get parentId() {\n    return this.#parentId;\n  }\n  /** Returns the parent context. */\n  get parent() {\n    if (this.parentId === null) {\n      return null;\n    }\n    return this.#browsingContextStorage.getContext(this.parentId);\n  }\n  /** Returns all direct children contexts. */\n  get directChildren() {\n    return [...this.#children].map(id => this.#browsingContextStorage.getContext(id));\n  }\n  /** Returns all children contexts, flattened. */\n  get allChildren() {\n    const children = this.directChildren;\n    return children.concat(...children.map(child => child.allChildren));\n  }\n  /**\n   * Returns true if this is a top-level context.\n   * This is the case whenever the parent context ID is null.\n   */\n  isTopLevelContext() {\n    return this.#parentId === null;\n  }\n  get top() {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let topContext = this;\n    let parent = topContext.parent;\n    while (parent) {\n      topContext = parent;\n      parent = topContext.parent;\n    }\n    return topContext;\n  }\n  addChild(childId) {\n    this.#children.add(childId);\n  }\n  #deleteAllChildren() {\n    this.directChildren.map(child => child.dispose());\n  }\n  get #defaultRealm() {\n    (0, assert_js_1.assert)(this.#maybeDefaultRealm, `No default realm for browsing context ${this.#id}`);\n    return this.#maybeDefaultRealm;\n  }\n  get cdpTarget() {\n    return this.#cdpTarget;\n  }\n  updateCdpTarget(cdpTarget) {\n    this.#cdpTarget = cdpTarget;\n    this.#initListeners();\n  }\n  get url() {\n    return this.#url;\n  }\n  async lifecycleLoaded() {\n    await this.#lifecycle.load;\n  }\n  async targetUnblockedOrThrow() {\n    const result = await this.#cdpTarget.unblocked;\n    if (result.kind === 'error') {\n      throw result.error;\n    }\n  }\n  async getOrCreateSandbox(sandbox) {\n    if (sandbox === undefined || sandbox === '') {\n      return this.#defaultRealm;\n    }\n    let maybeSandboxes = this.#realmStorage.findRealms({\n      browsingContextId: this.id,\n      sandbox\n    });\n    if (maybeSandboxes.length === 0) {\n      await this.#cdpTarget.cdpClient.sendCommand('Page.createIsolatedWorld', {\n        frameId: this.id,\n        worldName: sandbox\n      });\n      // `Runtime.executionContextCreated` should be emitted by the time the\n      // previous command is done.\n      maybeSandboxes = this.#realmStorage.findRealms({\n        browsingContextId: this.id,\n        sandbox\n      });\n      (0, assert_js_1.assert)(maybeSandboxes.length !== 0);\n    }\n    // It's possible for more than one sandbox to be created due to provisional\n    // frames. In this case, it's always the first one (i.e. the oldest one)\n    // that is more relevant since the user may have set that one up already\n    // through evaluation.\n    return maybeSandboxes[0];\n  }\n  serializeToBidiValue(maxDepth = 0, addParentField = true) {\n    return {\n      context: this.#id,\n      url: this.url,\n      userContext: this.userContext,\n      children: maxDepth > 0 ? this.directChildren.map(c => c.serializeToBidiValue(maxDepth - 1, false)) : null,\n      ...(addParentField ? {\n        parent: this.#parentId\n      } : {})\n    };\n  }\n  onTargetInfoChanged(params) {\n    this.#url = params.targetInfo.url;\n  }\n  #initListeners() {\n    this.#cdpTarget.cdpClient.on('Page.frameNavigated', params => {\n      if (this.id !== params.frame.id) {\n        return;\n      }\n      this.#url = params.frame.url + (params.frame.urlFragment ?? '');\n      // At the point the page is initialized, all the nested iframes from the\n      // previous page are detached and realms are destroyed.\n      // Remove children from context.\n      this.#deleteAllChildren();\n    });\n    this.#cdpTarget.cdpClient.on('Page.navigatedWithinDocument', params => {\n      if (this.id !== params.frameId) {\n        return;\n      }\n      const timestamp = BrowsingContextImpl.getTimestamp();\n      this.#url = params.url;\n      this.#navigation.withinDocument.resolve(params);\n      this.#eventManager.registerEvent({\n        type: 'event',\n        method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.FragmentNavigated,\n        params: {\n          context: this.id,\n          navigation: null,\n          timestamp,\n          url: this.#url\n        }\n      }, this.id);\n    });\n    this.#cdpTarget.cdpClient.on('Page.frameStartedLoading', params => {\n      if (this.id !== params.frameId) {\n        return;\n      }\n      this.#eventManager.registerEvent({\n        type: 'event',\n        method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.NavigationStarted,\n        params: {\n          context: this.id,\n          navigation: null,\n          timestamp: BrowsingContextImpl.getTimestamp(),\n          url: ''\n        }\n      }, this.id);\n    });\n    this.#cdpTarget.cdpClient.on('Page.lifecycleEvent', params => {\n      if (this.id !== params.frameId) {\n        return;\n      }\n      if (params.name === 'init') {\n        this.#documentChanged(params.loaderId);\n        return;\n      }\n      if (params.name === 'commit') {\n        this.#loaderId = params.loaderId;\n        return;\n      }\n      // If mapper attached to the page late, it might miss init and\n      // commit events. In that case, save the first loaderId for this\n      // frameId.\n      if (!this.#loaderId) {\n        this.#loaderId = params.loaderId;\n      }\n      // Ignore event from not current navigation.\n      if (params.loaderId !== this.#loaderId) {\n        return;\n      }\n      const timestamp = BrowsingContextImpl.getTimestamp();\n      switch (params.name) {\n        case 'DOMContentLoaded':\n          this.#eventManager.registerEvent({\n            type: 'event',\n            method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.DomContentLoaded,\n            params: {\n              context: this.id,\n              navigation: this.#loaderId ?? null,\n              timestamp,\n              url: this.#url\n            }\n          }, this.id);\n          this.#lifecycle.DOMContentLoaded.resolve(params);\n          break;\n        case 'load':\n          this.#eventManager.registerEvent({\n            type: 'event',\n            method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.Load,\n            params: {\n              context: this.id,\n              navigation: this.#loaderId ?? null,\n              timestamp,\n              url: this.#url\n            }\n          }, this.id);\n          this.#lifecycle.load.resolve(params);\n          break;\n      }\n    });\n    this.#cdpTarget.cdpClient.on('Runtime.executionContextCreated', params => {\n      const {\n        auxData,\n        name,\n        uniqueId,\n        id\n      } = params.context;\n      if (!auxData || auxData.frameId !== this.id) {\n        return;\n      }\n      let origin;\n      let sandbox;\n      // Only these execution contexts are supported for now.\n      switch (auxData.type) {\n        case 'isolated':\n          sandbox = name;\n          // Sandbox should have the same origin as the context itself, but in CDP\n          // it has an empty one.\n          origin = this.#defaultRealm.origin;\n          break;\n        case 'default':\n          origin = serializeOrigin(params.context.origin);\n          break;\n        default:\n          return;\n      }\n      const realm = new WindowRealm_js_1.WindowRealm(this.id, this.#browsingContextStorage, this.#cdpTarget.cdpClient, this.#eventManager, id, this.#logger, origin, uniqueId, this.#realmStorage, sandbox);\n      if (auxData.isDefault) {\n        this.#maybeDefaultRealm = realm;\n        // Initialize ChannelProxy listeners for all the channels of all the\n        // preload scripts related to this BrowsingContext.\n        // TODO: extend for not default realms by the sandbox name.\n        void Promise.all(this.#cdpTarget.getChannels().map(channel => channel.startListenerFromWindow(realm, this.#eventManager)));\n      }\n    });\n    this.#cdpTarget.cdpClient.on('Runtime.executionContextDestroyed', params => {\n      this.#realmStorage.deleteRealms({\n        cdpSessionId: this.#cdpTarget.cdpSessionId,\n        executionContextId: params.executionContextId\n      });\n    });\n    this.#cdpTarget.cdpClient.on('Runtime.executionContextsCleared', () => {\n      this.#realmStorage.deleteRealms({\n        cdpSessionId: this.#cdpTarget.cdpSessionId\n      });\n    });\n    this.#cdpTarget.cdpClient.on('Page.javascriptDialogClosed', params => {\n      const accepted = params.result;\n      this.#eventManager.registerEvent({\n        type: 'event',\n        method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.UserPromptClosed,\n        params: {\n          context: this.id,\n          accepted,\n          userText: accepted && params.userInput ? params.userInput : undefined\n        }\n      }, this.id);\n    });\n    this.#cdpTarget.cdpClient.on('Page.javascriptDialogOpening', params => {\n      this.#eventManager.registerEvent({\n        type: 'event',\n        method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.UserPromptOpened,\n        params: {\n          context: this.id,\n          type: params.type,\n          message: params.message,\n          // Don't set the value if empty string\n          defaultValue: params.defaultPrompt || undefined\n        }\n      }, this.id);\n    });\n  }\n  #documentChanged(loaderId) {\n    // Same document navigation.\n    if (loaderId === undefined || this.#loaderId === loaderId) {\n      if (this.#navigation.withinDocument.isFinished) {\n        this.#navigation.withinDocument = new Deferred_js_1.Deferred();\n      } else {\n        this.#logger?.(BrowsingContextImpl.LOGGER_PREFIX, 'Document changed (navigatedWithinDocument)');\n      }\n      return;\n    }\n    this.#resetLifecycleIfFinished();\n    this.#loaderId = loaderId;\n  }\n  #resetLifecycleIfFinished() {\n    if (this.#lifecycle.DOMContentLoaded.isFinished) {\n      this.#lifecycle.DOMContentLoaded = new Deferred_js_1.Deferred();\n    } else {\n      this.#logger?.(BrowsingContextImpl.LOGGER_PREFIX, 'Document changed (DOMContentLoaded)');\n    }\n    if (this.#lifecycle.load.isFinished) {\n      this.#lifecycle.load = new Deferred_js_1.Deferred();\n    } else {\n      this.#logger?.(BrowsingContextImpl.LOGGER_PREFIX, 'Document changed (load)');\n    }\n  }\n  #failLifecycleIfNotFinished() {\n    if (!this.#lifecycle.DOMContentLoaded.isFinished) {\n      this.#lifecycle.DOMContentLoaded.reject(new protocol_js_1.UnknownErrorException('navigation canceled'));\n    }\n    if (!this.#lifecycle.load.isFinished) {\n      this.#lifecycle.load.reject(new protocol_js_1.UnknownErrorException('navigation canceled'));\n    }\n  }\n  async navigate(url, wait) {\n    try {\n      new URL(url);\n    } catch {\n      throw new protocol_js_1.InvalidArgumentException(`Invalid URL: ${url}`);\n    }\n    await this.targetUnblockedOrThrow();\n    // TODO: handle loading errors.\n    const cdpNavigateResult = await this.#cdpTarget.cdpClient.sendCommand('Page.navigate', {\n      url,\n      frameId: this.id\n    });\n    if (cdpNavigateResult.errorText) {\n      this.#eventManager.registerEvent({\n        type: 'event',\n        method: protocol_js_1.ChromiumBidi.BrowsingContext.EventNames.NavigationFailed,\n        params: {\n          context: this.id,\n          navigation: cdpNavigateResult.loaderId ?? null,\n          timestamp: BrowsingContextImpl.getTimestamp(),\n          url\n        }\n      }, this.id);\n      throw new protocol_js_1.UnknownErrorException(cdpNavigateResult.errorText);\n    }\n    this.#documentChanged(cdpNavigateResult.loaderId);\n    switch (wait) {\n      case \"none\" /* BrowsingContext.ReadinessState.None */:\n        break;\n      case \"interactive\" /* BrowsingContext.ReadinessState.Interactive */:\n        // No `loaderId` means same-document navigation.\n        if (cdpNavigateResult.loaderId === undefined) {\n          await this.#navigation.withinDocument;\n        } else {\n          await this.#lifecycle.DOMContentLoaded;\n        }\n        break;\n      case \"complete\" /* BrowsingContext.ReadinessState.Complete */:\n        // No `loaderId` means same-document navigation.\n        if (cdpNavigateResult.loaderId === undefined) {\n          await this.#navigation.withinDocument;\n        } else {\n          await this.#lifecycle.load;\n        }\n        break;\n    }\n    return {\n      navigation: cdpNavigateResult.loaderId ?? null,\n      // Url can change due to redirect get the latest one.\n      url: wait === \"none\" /* BrowsingContext.ReadinessState.None */ ? url : this.#url\n    };\n  }\n  async reload(ignoreCache, wait) {\n    await this.targetUnblockedOrThrow();\n    this.#resetLifecycleIfFinished();\n    await this.#cdpTarget.cdpClient.sendCommand('Page.reload', {\n      ignoreCache\n    });\n    switch (wait) {\n      case \"none\" /* BrowsingContext.ReadinessState.None */:\n        break;\n      case \"interactive\" /* BrowsingContext.ReadinessState.Interactive */:\n        await this.#lifecycle.DOMContentLoaded;\n        break;\n      case \"complete\" /* BrowsingContext.ReadinessState.Complete */:\n        await this.#lifecycle.load;\n        break;\n    }\n    return {\n      navigation: wait === \"none\" /* BrowsingContext.ReadinessState.None */ ? null : this.navigableId ?? null,\n      url: this.url\n    };\n  }\n  async setViewport(viewport, devicePixelRatio) {\n    if (viewport === null && devicePixelRatio === null) {\n      await this.#cdpTarget.cdpClient.sendCommand('Emulation.clearDeviceMetricsOverride');\n    } else {\n      try {\n        let appliedViewport;\n        if (viewport === undefined) {\n          appliedViewport = this.#previousViewport;\n        } else if (viewport === null) {\n          appliedViewport = {\n            width: 0,\n            height: 0\n          };\n        } else {\n          appliedViewport = viewport;\n        }\n        this.#previousViewport = appliedViewport;\n        await this.#cdpTarget.cdpClient.sendCommand('Emulation.setDeviceMetricsOverride', {\n          width: this.#previousViewport.width,\n          height: this.#previousViewport.height,\n          deviceScaleFactor: devicePixelRatio ? devicePixelRatio : 0,\n          mobile: false,\n          dontSetVisibleSize: true\n        });\n      } catch (err) {\n        if (err.message.startsWith(\n        // https://crsrc.org/c/content/browser/devtools/protocol/emulation_handler.cc;l=257;drc=2f6eee84cf98d4227e7c41718dd71b82f26d90ff\n        'Width and height values must be positive')) {\n          throw new protocol_js_1.UnsupportedOperationException('Provided viewport dimensions are not supported');\n        }\n        throw err;\n      }\n    }\n  }\n  async handleUserPrompt(params) {\n    await this.#cdpTarget.cdpClient.sendCommand('Page.handleJavaScriptDialog', {\n      accept: params.accept ?? true,\n      promptText: params.userText\n    });\n  }\n  async activate() {\n    await this.#cdpTarget.cdpClient.sendCommand('Page.bringToFront');\n  }\n  async captureScreenshot(params) {\n    if (!this.isTopLevelContext()) {\n      throw new protocol_js_1.UnsupportedOperationException(`Non-top-level 'context' (${params.context}) is currently not supported`);\n    }\n    const formatParameters = getImageFormatParameters(params);\n    // XXX: Focus the original tab after the screenshot is taken.\n    // This is needed because the screenshot gets blocked until the active tab gets focus.\n    await this.#cdpTarget.cdpClient.sendCommand('Page.bringToFront');\n    let captureBeyondViewport = false;\n    let script;\n    params.origin ??= 'viewport';\n    switch (params.origin) {\n      case 'document':\n        {\n          script = String(() => {\n            const element = document.documentElement;\n            return {\n              x: 0,\n              y: 0,\n              width: element.scrollWidth,\n              height: element.scrollHeight\n            };\n          });\n          captureBeyondViewport = true;\n          break;\n        }\n      case 'viewport':\n        {\n          script = String(() => {\n            const viewport = window.visualViewport;\n            return {\n              x: viewport.pageLeft,\n              y: viewport.pageTop,\n              width: viewport.width,\n              height: viewport.height\n            };\n          });\n          break;\n        }\n    }\n    const realm = await this.getOrCreateSandbox(undefined);\n    const originResult = await realm.callFunction(script, false);\n    (0, assert_js_1.assert)(originResult.type === 'success');\n    const origin = deserializeDOMRect(originResult.result);\n    (0, assert_js_1.assert)(origin);\n    const rect = params.clip ? getIntersectionRect(await this.#parseRect(params.clip), origin) : origin;\n    if (rect.width === 0 || rect.height === 0) {\n      throw new protocol_js_1.UnableToCaptureScreenException(`Unable to capture screenshot with zero dimensions: width=${rect.width}, height=${rect.height}`);\n    }\n    return await this.#cdpTarget.cdpClient.sendCommand('Page.captureScreenshot', {\n      clip: {\n        ...rect,\n        scale: 1.0\n      },\n      ...formatParameters,\n      captureBeyondViewport\n    });\n  }\n  async print(params) {\n    const cdpParams = {};\n    if (params.background !== undefined) {\n      cdpParams.printBackground = params.background;\n    }\n    if (params.margin?.bottom !== undefined) {\n      cdpParams.marginBottom = (0, unitConversions_js_1.inchesFromCm)(params.margin.bottom);\n    }\n    if (params.margin?.left !== undefined) {\n      cdpParams.marginLeft = (0, unitConversions_js_1.inchesFromCm)(params.margin.left);\n    }\n    if (params.margin?.right !== undefined) {\n      cdpParams.marginRight = (0, unitConversions_js_1.inchesFromCm)(params.margin.right);\n    }\n    if (params.margin?.top !== undefined) {\n      cdpParams.marginTop = (0, unitConversions_js_1.inchesFromCm)(params.margin.top);\n    }\n    if (params.orientation !== undefined) {\n      cdpParams.landscape = params.orientation === 'landscape';\n    }\n    if (params.page?.height !== undefined) {\n      cdpParams.paperHeight = (0, unitConversions_js_1.inchesFromCm)(params.page.height);\n    }\n    if (params.page?.width !== undefined) {\n      cdpParams.paperWidth = (0, unitConversions_js_1.inchesFromCm)(params.page.width);\n    }\n    if (params.pageRanges !== undefined) {\n      for (const range of params.pageRanges) {\n        if (typeof range === 'number') {\n          continue;\n        }\n        const rangeParts = range.split('-');\n        if (rangeParts.length < 1 || rangeParts.length > 2) {\n          throw new protocol_js_1.InvalidArgumentException(`Invalid page range: ${range} is not a valid integer range.`);\n        }\n        if (rangeParts.length === 1) {\n          void parseInteger(rangeParts[0] ?? '');\n          continue;\n        }\n        let lowerBound;\n        let upperBound;\n        const [rangeLowerPart = '', rangeUpperPart = ''] = rangeParts;\n        if (rangeLowerPart === '') {\n          lowerBound = 1;\n        } else {\n          lowerBound = parseInteger(rangeLowerPart);\n        }\n        if (rangeUpperPart === '') {\n          upperBound = Number.MAX_SAFE_INTEGER;\n        } else {\n          upperBound = parseInteger(rangeUpperPart);\n        }\n        if (lowerBound > upperBound) {\n          throw new protocol_js_1.InvalidArgumentException(`Invalid page range: ${rangeLowerPart} > ${rangeUpperPart}`);\n        }\n      }\n      cdpParams.pageRanges = params.pageRanges.join(',');\n    }\n    if (params.scale !== undefined) {\n      cdpParams.scale = params.scale;\n    }\n    if (params.shrinkToFit !== undefined) {\n      cdpParams.preferCSSPageSize = !params.shrinkToFit;\n    }\n    try {\n      const result = await this.#cdpTarget.cdpClient.sendCommand('Page.printToPDF', cdpParams);\n      return {\n        data: result.data\n      };\n    } catch (error) {\n      // Effectively zero dimensions.\n      if (error.message === 'invalid print parameters: content area is empty') {\n        throw new protocol_js_1.UnsupportedOperationException(error.message);\n      }\n      throw error;\n    }\n  }\n  /**\n   * See\n   * https://w3c.github.io/webdriver-bidi/#:~:text=If%20command%20parameters%20contains%20%22clip%22%3A\n   */\n  async #parseRect(clip) {\n    switch (clip.type) {\n      case 'box':\n        return {\n          x: clip.x,\n          y: clip.y,\n          width: clip.width,\n          height: clip.height\n        };\n      case 'element':\n        {\n          // TODO: #1213: Use custom sandbox specifically for Chromium BiDi\n          const sandbox = await this.getOrCreateSandbox(undefined);\n          const result = await sandbox.callFunction(String(element => {\n            return element instanceof Element;\n          }), false, {\n            type: 'undefined'\n          }, [clip.element]);\n          if (result.type === 'exception') {\n            throw new protocol_js_1.NoSuchElementException(`Element '${clip.element.sharedId}' was not found`);\n          }\n          (0, assert_js_1.assert)(result.result.type === 'boolean');\n          if (!result.result.value) {\n            throw new protocol_js_1.NoSuchElementException(`Node '${clip.element.sharedId}' is not an Element`);\n          }\n          {\n            const result = await sandbox.callFunction(String(element => {\n              const rect = element.getBoundingClientRect();\n              return {\n                x: rect.x,\n                y: rect.y,\n                height: rect.height,\n                width: rect.width\n              };\n            }), false, {\n              type: 'undefined'\n            }, [clip.element]);\n            (0, assert_js_1.assert)(result.type === 'success');\n            const rect = deserializeDOMRect(result.result);\n            if (!rect) {\n              throw new protocol_js_1.UnableToCaptureScreenException(`Could not get bounding box for Element '${clip.element.sharedId}'`);\n            }\n            return rect;\n          }\n        }\n    }\n  }\n  async close() {\n    await this.#cdpTarget.cdpClient.sendCommand('Page.close');\n  }\n  async traverseHistory(delta) {\n    if (delta === 0) {\n      return;\n    }\n    const history = await this.#cdpTarget.cdpClient.sendCommand('Page.getNavigationHistory');\n    const entry = history.entries[history.currentIndex + delta];\n    if (!entry) {\n      throw new protocol_js_1.NoSuchHistoryEntryException(`No history entry at delta ${delta}`);\n    }\n    await this.#cdpTarget.cdpClient.sendCommand('Page.navigateToHistoryEntry', {\n      entryId: entry.id\n    });\n  }\n  async toggleModulesIfNeeded() {\n    await this.#cdpTarget.toggleNetworkIfNeeded();\n  }\n  async locateNodes(params) {\n    // TODO: create a dedicated sandbox instead of `#defaultRealm`.\n    return await this.#locateNodesByLocator(this.#defaultRealm, params.locator, params.startNodes ?? [], params.maxNodeCount, params.serializationOptions);\n  }\n  #getLocatorDelegate(locator, maxNodeCount, startNodes) {\n    switch (locator.type) {\n      case 'css':\n        return {\n          functionDeclaration: String((cssSelector, maxNodeCount, ...startNodes) => {\n            const locateNodesUsingCss = element => {\n              if (!(element instanceof HTMLElement)) {\n                throw new Error('startNodes in css selector should be HTMLElement');\n              }\n              return [...element.querySelectorAll(cssSelector)];\n            };\n            startNodes = startNodes.length > 0 ? startNodes : [document.body];\n            const returnedNodes = startNodes.map(startNode =>\n            // TODO: stop search early if `maxNodeCount` is reached.\n            locateNodesUsingCss(startNode)).flat(1);\n            return maxNodeCount === 0 ? returnedNodes : returnedNodes.slice(0, maxNodeCount);\n          }),\n          argumentsLocalValues: [\n          // `cssSelector`\n          {\n            type: 'string',\n            value: locator.value\n          },\n          // `maxNodeCount` with `0` means no limit.\n          {\n            type: 'number',\n            value: maxNodeCount ?? 0\n          },\n          // `startNodes`\n          ...startNodes]\n        };\n      case 'xpath':\n        return {\n          functionDeclaration: String((xPathSelector, maxNodeCount, ...startNodes) => {\n            // https://w3c.github.io/webdriver-bidi/#locate-nodes-using-xpath\n            const evaluator = new XPathEvaluator();\n            const expression = evaluator.createExpression(xPathSelector);\n            const locateNodesUsingXpath = element => {\n              const xPathResult = expression.evaluate(element, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);\n              const returnedNodes = [];\n              for (let i = 0; i < xPathResult.snapshotLength; i++) {\n                returnedNodes.push(xPathResult.snapshotItem(i));\n              }\n              return returnedNodes;\n            };\n            startNodes = startNodes.length > 0 ? startNodes : [document.body];\n            const returnedNodes = startNodes.map(startNode =>\n            // TODO: stop search early if `maxNodeCount` is reached.\n            locateNodesUsingXpath(startNode)).flat(1);\n            return maxNodeCount === 0 ? returnedNodes : returnedNodes.slice(0, maxNodeCount);\n          }),\n          argumentsLocalValues: [\n          // `xPathSelector`\n          {\n            type: 'string',\n            value: locator.value\n          },\n          // `maxNodeCount` with `0` means no limit.\n          {\n            type: 'number',\n            value: maxNodeCount ?? 0\n          },\n          // `startNodes`\n          ...startNodes]\n        };\n      case 'innerText':\n        // https://w3c.github.io/webdriver-bidi/#locate-nodes-using-inner-text\n        if (locator.value === '') {\n          throw new protocol_js_1.InvalidSelectorException('innerText locator cannot be empty');\n        }\n        return {\n          functionDeclaration: String((innerTextSelector, fullMatch, ignoreCase, maxNodeCount, maxDepth, ...startNodes) => {\n            const searchText = ignoreCase ? innerTextSelector.toUpperCase() : innerTextSelector;\n            const locateNodesUsingInnerText = (element, currentMaxDepth) => {\n              const returnedNodes = [];\n              const nodeInnerText = ignoreCase ? element.innerText?.toUpperCase() : element.innerText;\n              if (!nodeInnerText.includes(searchText)) {\n                return [];\n              }\n              const childNodes = [];\n              for (const child of element.children) {\n                if (child instanceof HTMLElement) {\n                  childNodes.push(child);\n                }\n              }\n              if (childNodes.length === 0) {\n                if (fullMatch && nodeInnerText === searchText) {\n                  returnedNodes.push(element);\n                } else {\n                  if (!fullMatch) {\n                    // Note: `nodeInnerText.includes(searchText)` is already checked\n                    returnedNodes.push(element);\n                  }\n                }\n              } else {\n                const childNodeMatches =\n                // Don't search deeper if `maxDepth` is reached.\n                currentMaxDepth === 0 ? [] : childNodes.map(child => locateNodesUsingInnerText(child, currentMaxDepth - 1)).flat(1);\n                if (childNodeMatches.length === 0) {\n                  // Note: `nodeInnerText.includes(searchText)` is already checked\n                  if (!fullMatch || nodeInnerText === searchText) {\n                    returnedNodes.push(element);\n                  }\n                } else {\n                  returnedNodes.push(...childNodeMatches);\n                }\n              }\n              // TODO: stop search early if `maxNodeCount` is reached.\n              return returnedNodes;\n            };\n            // TODO: add maxDepth.\n            // TODO: stop search early if `maxNodeCount` is reached.\n            startNodes = startNodes.length > 0 ? startNodes : [document.body];\n            const returnedNodes = startNodes.map(startNode =>\n            // TODO: stop search early if `maxNodeCount` is reached.\n            locateNodesUsingInnerText(startNode, maxDepth)).flat(1);\n            return maxNodeCount === 0 ? returnedNodes : returnedNodes.slice(0, maxNodeCount);\n          }),\n          argumentsLocalValues: [\n          // `innerTextSelector`\n          {\n            type: 'string',\n            value: locator.value\n          },\n          // `fullMatch` with default `true`.\n          {\n            type: 'boolean',\n            value: locator.matchType !== 'partial'\n          },\n          // `ignoreCase` with default `false`.\n          {\n            type: 'boolean',\n            value: locator.ignoreCase === true\n          },\n          // `maxNodeCount` with `0` means no limit.\n          {\n            type: 'number',\n            value: maxNodeCount ?? 0\n          },\n          // `maxDepth` with default `1000` (same as default full serialization depth).\n          {\n            type: 'number',\n            value: locator.maxDepth ?? 1000\n          },\n          // `startNodes`\n          ...startNodes]\n        };\n    }\n  }\n  async #locateNodesByLocator(realm, locator, startNodes, maxNodeCount, serializationOptions) {\n    const locatorDelegate = this.#getLocatorDelegate(locator, maxNodeCount, startNodes);\n    serializationOptions = {\n      ...serializationOptions,\n      // The returned object is an array of nodes, so no need in deeper JS serialization.\n      maxObjectDepth: 1\n    };\n    const locatorResult = await realm.callFunction(locatorDelegate.functionDeclaration, false, {\n      type: 'undefined'\n    }, locatorDelegate.argumentsLocalValues, \"none\" /* Script.ResultOwnership.None */, serializationOptions);\n    if (locatorResult.type !== 'success') {\n      this.#logger?.(BrowsingContextImpl.LOGGER_PREFIX, 'Failed locateNodesByLocator', locatorResult);\n      // Heuristic to detect invalid selector for different types of selectors.\n      if (\n      // CSS selector.\n      locatorResult.exceptionDetails.text?.endsWith('is not a valid selector.') ||\n      // XPath selector.\n      locatorResult.exceptionDetails.text?.endsWith('is not a valid XPath expression.')) {\n        throw new protocol_js_1.InvalidSelectorException(`Not valid selector ${locator.value}`);\n      }\n      // Heuristic to detect if the `startNode` is not an `HTMLElement` in css selector.\n      if (locatorResult.exceptionDetails.text === 'Error: startNodes in css selector should be HTMLElement') {\n        throw new protocol_js_1.InvalidArgumentException(`startNodes in css selector should be HTMLElement`);\n      }\n      throw new protocol_js_1.UnknownErrorException(`Unexpected error in selector script: ${locatorResult.exceptionDetails.text}`);\n    }\n    if (locatorResult.result.type !== 'array') {\n      throw new protocol_js_1.UnknownErrorException(`Unexpected selector script result type: ${locatorResult.result.type}`);\n    }\n    // Check there are no non-node elements in the result.\n    const nodes = locatorResult.result.value.map(value => {\n      if (value.type !== 'node') {\n        throw new protocol_js_1.UnknownErrorException(`Unexpected selector script result element: ${value.type}`);\n      }\n      return value;\n    });\n    return {\n      nodes\n    };\n  }\n}\nexports.BrowsingContextImpl = BrowsingContextImpl;\nfunction serializeOrigin(origin) {\n  // https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin\n  if (['://', ''].includes(origin)) {\n    origin = 'null';\n  }\n  return origin;\n}\nexports.serializeOrigin = serializeOrigin;\nfunction getImageFormatParameters(params) {\n  const {\n    quality,\n    type\n  } = params.format ?? {\n    type: 'image/png'\n  };\n  switch (type) {\n    case 'image/png':\n      {\n        return {\n          format: 'png'\n        };\n      }\n    case 'image/jpeg':\n      {\n        return {\n          format: 'jpeg',\n          ...(quality === undefined ? {} : {\n            quality: Math.round(quality * 100)\n          })\n        };\n      }\n    case 'image/webp':\n      {\n        return {\n          format: 'webp',\n          ...(quality === undefined ? {} : {\n            quality: Math.round(quality * 100)\n          })\n        };\n      }\n  }\n  throw new protocol_js_1.InvalidArgumentException(`Image format '${type}' is not a supported format`);\n}\nfunction deserializeDOMRect(result) {\n  if (result.type !== 'object' || result.value === undefined) {\n    return;\n  }\n  const x = result.value.find(([key]) => {\n    return key === 'x';\n  })?.[1];\n  const y = result.value.find(([key]) => {\n    return key === 'y';\n  })?.[1];\n  const height = result.value.find(([key]) => {\n    return key === 'height';\n  })?.[1];\n  const width = result.value.find(([key]) => {\n    return key === 'width';\n  })?.[1];\n  if (x?.type !== 'number' || y?.type !== 'number' || height?.type !== 'number' || width?.type !== 'number') {\n    return;\n  }\n  return {\n    x: x.value,\n    y: y.value,\n    width: width.value,\n    height: height.value\n  };\n}\n/** @see https://w3c.github.io/webdriver-bidi/#normalize-rect */\nfunction normalizeRect(box) {\n  return {\n    ...(box.width < 0 ? {\n      x: box.x + box.width,\n      width: -box.width\n    } : {\n      x: box.x,\n      width: box.width\n    }),\n    ...(box.height < 0 ? {\n      y: box.y + box.height,\n      height: -box.height\n    } : {\n      y: box.y,\n      height: box.height\n    })\n  };\n}\n/** @see https://w3c.github.io/webdriver-bidi/#rectangle-intersection */\nfunction getIntersectionRect(first, second) {\n  first = normalizeRect(first);\n  second = normalizeRect(second);\n  const x = Math.max(first.x, second.x);\n  const y = Math.max(first.y, second.y);\n  return {\n    x,\n    y,\n    width: Math.max(Math.min(first.x + first.width, second.x + second.width) - x, 0),\n    height: Math.max(Math.min(first.y + first.height, second.y + second.height) - y, 0)\n  };\n}\nfunction parseInteger(value) {\n  value = value.trim();\n  if (!/^[0-9]+$/.test(value)) {\n    throw new protocol_js_1.InvalidArgumentException(`Invalid integer: ${value}`);\n  }\n  return parseInt(value);\n}","map":{"version":3,"names":["protocol_js_1","require","assert_js_1","Deferred_js_1","log_js_1","unitConversions_js_1","WindowRealm_js_1","BrowsingContextImpl","LOGGER_PREFIX","LogType","debug","id","userContext","parentId","children","Set","browsingContextStorage","lifecycle","DOMContentLoaded","Deferred","load","navigation","withinDocument","url","eventManager","realmStorage","loaderId","cdpTarget","maybeDefaultRealm","logger","previousViewport","width","height","constructor","create","context","initListeners","addContext","isTopLevelContext","parent","addChild","registerEvent","type","method","ChromiumBidi","BrowsingContext","EventNames","ContextCreated","params","serializeToBidiValue","getTimestamp","Date","getTime","navigableId","dispose","deleteAllChildren","deleteRealms","browsingContextId","delete","failLifecycleIfNotFinished","ContextDestroyed","deleteContextById","getContext","directChildren","map","allChildren","concat","child","top","topContext","childId","add","#deleteAllChildren","defaultRealm","#defaultRealm","assert","updateCdpTarget","lifecycleLoaded","targetUnblockedOrThrow","result","unblocked","kind","error","getOrCreateSandbox","sandbox","undefined","maybeSandboxes","findRealms","length","cdpClient","sendCommand","frameId","worldName","maxDepth","addParentField","c","onTargetInfoChanged","targetInfo","#initListeners","on","frame","urlFragment","timestamp","resolve","FragmentNavigated","NavigationStarted","name","documentChanged","DomContentLoaded","Load","auxData","uniqueId","origin","serializeOrigin","realm","WindowRealm","isDefault","Promise","all","getChannels","channel","startListenerFromWindow","cdpSessionId","executionContextId","accepted","UserPromptClosed","userText","userInput","UserPromptOpened","message","defaultValue","defaultPrompt","#documentChanged","isFinished","resetLifecycleIfFinished","#resetLifecycleIfFinished","#failLifecycleIfNotFinished","reject","UnknownErrorException","navigate","wait","URL","InvalidArgumentException","cdpNavigateResult","errorText","NavigationFailed","reload","ignoreCache","setViewport","viewport","devicePixelRatio","appliedViewport","deviceScaleFactor","mobile","dontSetVisibleSize","err","startsWith","UnsupportedOperationException","handleUserPrompt","accept","promptText","activate","captureScreenshot","formatParameters","getImageFormatParameters","captureBeyondViewport","script","String","element","document","documentElement","x","y","scrollWidth","scrollHeight","window","visualViewport","pageLeft","pageTop","originResult","callFunction","deserializeDOMRect","rect","clip","getIntersectionRect","parseRect","UnableToCaptureScreenException","scale","print","cdpParams","background","printBackground","margin","bottom","marginBottom","inchesFromCm","left","marginLeft","right","marginRight","marginTop","orientation","landscape","page","paperHeight","paperWidth","pageRanges","range","rangeParts","split","parseInteger","lowerBound","upperBound","rangeLowerPart","rangeUpperPart","Number","MAX_SAFE_INTEGER","join","shrinkToFit","preferCSSPageSize","data","#parseRect","Element","NoSuchElementException","sharedId","value","getBoundingClientRect","close","traverseHistory","delta","history","entry","entries","currentIndex","NoSuchHistoryEntryException","entryId","toggleModulesIfNeeded","toggleNetworkIfNeeded","locateNodes","locateNodesByLocator","locator","startNodes","maxNodeCount","serializationOptions","getLocatorDelegate","#getLocatorDelegate","functionDeclaration","cssSelector","locateNodesUsingCss","HTMLElement","Error","querySelectorAll","body","returnedNodes","startNode","flat","slice","argumentsLocalValues","xPathSelector","evaluator","XPathEvaluator","expression","createExpression","locateNodesUsingXpath","xPathResult","evaluate","XPathResult","ORDERED_NODE_SNAPSHOT_TYPE","i","snapshotLength","push","snapshotItem","InvalidSelectorException","innerTextSelector","fullMatch","ignoreCase","searchText","toUpperCase","locateNodesUsingInnerText","currentMaxDepth","nodeInnerText","innerText","includes","childNodes","childNodeMatches","matchType","#locateNodesByLocator","locatorDelegate","maxObjectDepth","locatorResult","exceptionDetails","text","endsWith","nodes","exports","quality","format","Math","round","find","key","normalizeRect","box","first","second","max","min","trim","test","parseInt"],"sources":["../../../../../src/bidiMapper/modules/context/BrowsingContextImpl.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}