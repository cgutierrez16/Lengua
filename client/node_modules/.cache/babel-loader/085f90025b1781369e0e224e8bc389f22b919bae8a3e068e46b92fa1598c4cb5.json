{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2022 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SubscriptionManager = exports.unrollEvents = exports.cartesianProduct = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst events_js_1 = require(\"./events.js\");\n/**\n * Returns the cartesian product of the given arrays.\n *\n * Example:\n *   cartesian([1, 2], ['a', 'b']); => [[1, 'a'], [1, 'b'], [2, 'a'], [2, 'b']]\n */\nfunction cartesianProduct(...a) {\n  return a.reduce((a, b) => a.flatMap(d => b.map(e => [d, e].flat())));\n}\nexports.cartesianProduct = cartesianProduct;\n/** Expands \"AllEvents\" events into atomic events. */\nfunction unrollEvents(events) {\n  const allEvents = new Set();\n  function addEvents(events) {\n    for (const event of events) {\n      allEvents.add(event);\n    }\n  }\n  for (const event of events) {\n    switch (event) {\n      case protocol_js_1.ChromiumBidi.BiDiModule.BrowsingContext:\n        addEvents(Object.values(protocol_js_1.ChromiumBidi.BrowsingContext.EventNames));\n        break;\n      case protocol_js_1.ChromiumBidi.BiDiModule.Log:\n        addEvents(Object.values(protocol_js_1.ChromiumBidi.Log.EventNames));\n        break;\n      case protocol_js_1.ChromiumBidi.BiDiModule.Network:\n        addEvents(Object.values(protocol_js_1.ChromiumBidi.Network.EventNames));\n        break;\n      case protocol_js_1.ChromiumBidi.BiDiModule.Script:\n        addEvents(Object.values(protocol_js_1.ChromiumBidi.Script.EventNames));\n        break;\n      default:\n        allEvents.add(event);\n    }\n  }\n  return [...allEvents.values()];\n}\nexports.unrollEvents = unrollEvents;\nclass SubscriptionManager {\n  #subscriptionPriority = 0;\n  // BrowsingContext `null` means the event has subscription across all the\n  // browsing contexts.\n  // Channel `null` means no `channel` should be added.\n  #channelToContextToEventMap = new Map();\n  #browsingContextStorage;\n  constructor(browsingContextStorage) {\n    this.#browsingContextStorage = browsingContextStorage;\n  }\n  getChannelsSubscribedToEvent(eventMethod, contextId) {\n    const prioritiesAndChannels = Array.from(this.#channelToContextToEventMap.keys()).map(channel => ({\n      priority: this.#getEventSubscriptionPriorityForChannel(eventMethod, contextId, channel),\n      channel\n    })).filter(({\n      priority\n    }) => priority !== null);\n    // Sort channels by priority.\n    return prioritiesAndChannels.sort((a, b) => a.priority - b.priority).map(({\n      channel\n    }) => channel);\n  }\n  #getEventSubscriptionPriorityForChannel(eventMethod, contextId, channel) {\n    const contextToEventMap = this.#channelToContextToEventMap.get(channel);\n    if (contextToEventMap === undefined) {\n      return null;\n    }\n    const maybeTopLevelContextId = this.#browsingContextStorage.findTopLevelContextId(contextId);\n    // `null` covers global subscription.\n    const relevantContexts = [...new Set([null, maybeTopLevelContextId])];\n    // Get all the subscription priorities.\n    const priorities = relevantContexts.map(context => {\n      // Get the priority for exact event name\n      const priority = contextToEventMap.get(context)?.get(eventMethod);\n      // For CDP we can't provide specific event name when subscribing\n      // to the module directly.\n      // Because of that we need to see event `cdp` exits in the map.\n      if ((0, events_js_1.isCdpEvent)(eventMethod)) {\n        const cdpPriority = contextToEventMap.get(context)?.get(protocol_js_1.ChromiumBidi.BiDiModule.Cdp);\n        // If we subscribe to the event directly and `cdp` module as well\n        // priority will be different we take minimal priority\n        return priority && cdpPriority ? Math.min(priority, cdpPriority) :\n        // At this point we know that we have subscribed\n        // to only one of the two\n        priority ?? cdpPriority;\n      }\n      return priority;\n    }).filter(p => p !== undefined);\n    if (priorities.length === 0) {\n      // Not subscribed, return null.\n      return null;\n    }\n    // Return minimal priority.\n    return Math.min(...priorities);\n  }\n  /**\n   * @param module BiDi+ module\n   * @param contextId `null` == globally subscribed\n   *\n   * @returns\n   */\n  isSubscribedTo(moduleOrEvent, contextId = null) {\n    const topLevelContext = this.#browsingContextStorage.findTopLevelContextId(contextId);\n    for (const browserContextToEventMap of this.#channelToContextToEventMap.values()) {\n      for (const [id, eventMap] of browserContextToEventMap.entries()) {\n        // Not subscribed to this context or globally\n        if (topLevelContext !== id && id !== null) {\n          continue;\n        }\n        for (const event of eventMap.keys()) {\n          // This also covers the `cdp` case where\n          // we don't unroll the event names\n          if (\n          // Event explicitly subscribed\n          event === moduleOrEvent ||\n          // Event subscribed via module\n          event === moduleOrEvent.split('.').at(0) ||\n          // Event explicitly subscribed compared to module\n          event.split('.').at(0) === moduleOrEvent) {\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  }\n  subscribe(event, contextId, channel) {\n    // All the subscriptions are handled on the top-level contexts.\n    contextId = this.#browsingContextStorage.findTopLevelContextId(contextId);\n    // Check if subscribed event is a whole module\n    switch (event) {\n      case protocol_js_1.ChromiumBidi.BiDiModule.BrowsingContext:\n        Object.values(protocol_js_1.ChromiumBidi.BrowsingContext.EventNames).map(specificEvent => this.subscribe(specificEvent, contextId, channel));\n        return;\n      case protocol_js_1.ChromiumBidi.BiDiModule.Log:\n        Object.values(protocol_js_1.ChromiumBidi.Log.EventNames).map(specificEvent => this.subscribe(specificEvent, contextId, channel));\n        return;\n      case protocol_js_1.ChromiumBidi.BiDiModule.Network:\n        Object.values(protocol_js_1.ChromiumBidi.Network.EventNames).map(specificEvent => this.subscribe(specificEvent, contextId, channel));\n        return;\n      case protocol_js_1.ChromiumBidi.BiDiModule.Script:\n        Object.values(protocol_js_1.ChromiumBidi.Script.EventNames).map(specificEvent => this.subscribe(specificEvent, contextId, channel));\n        return;\n      default:\n      // Intentionally left empty.\n    }\n    if (!this.#channelToContextToEventMap.has(channel)) {\n      this.#channelToContextToEventMap.set(channel, new Map());\n    }\n    const contextToEventMap = this.#channelToContextToEventMap.get(channel);\n    if (!contextToEventMap.has(contextId)) {\n      contextToEventMap.set(contextId, new Map());\n    }\n    const eventMap = contextToEventMap.get(contextId);\n    // Do not re-subscribe to events to keep the priority.\n    if (eventMap.has(event)) {\n      return;\n    }\n    eventMap.set(event, this.#subscriptionPriority++);\n  }\n  /**\n   * Unsubscribes atomically from all events in the given contexts and channel.\n   */\n  unsubscribeAll(events, contextIds, channel) {\n    // Assert all contexts are known.\n    for (const contextId of contextIds) {\n      if (contextId !== null) {\n        this.#browsingContextStorage.getContext(contextId);\n      }\n    }\n    const eventContextPairs = cartesianProduct(unrollEvents(events), contextIds);\n    // Assert all unsubscriptions are valid.\n    // If any of the unsubscriptions are invalid, do not unsubscribe from anything.\n    eventContextPairs.map(([event, contextId]) => this.#checkUnsubscribe(event, contextId, channel)).forEach(unsubscribe => unsubscribe());\n  }\n  /**\n   * Unsubscribes from the event in the given context and channel.\n   * Syntactic sugar for \"unsubscribeAll\".\n   */\n  unsubscribe(eventName, contextId, channel) {\n    this.unsubscribeAll([eventName], [contextId], channel);\n  }\n  #checkUnsubscribe(event, contextId, channel) {\n    // All the subscriptions are handled on the top-level contexts.\n    contextId = this.#browsingContextStorage.findTopLevelContextId(contextId);\n    if (!this.#channelToContextToEventMap.has(channel)) {\n      throw new protocol_js_1.InvalidArgumentException(`Cannot unsubscribe from ${event}, ${contextId === null ? 'null' : contextId}. No subscription found.`);\n    }\n    const contextToEventMap = this.#channelToContextToEventMap.get(channel);\n    if (!contextToEventMap.has(contextId)) {\n      throw new protocol_js_1.InvalidArgumentException(`Cannot unsubscribe from ${event}, ${contextId === null ? 'null' : contextId}. No subscription found.`);\n    }\n    const eventMap = contextToEventMap.get(contextId);\n    if (!eventMap.has(event)) {\n      throw new protocol_js_1.InvalidArgumentException(`Cannot unsubscribe from ${event}, ${contextId === null ? 'null' : contextId}. No subscription found.`);\n    }\n    return () => {\n      eventMap.delete(event);\n      // Clean up maps if empty.\n      if (eventMap.size === 0) {\n        contextToEventMap.delete(event);\n      }\n      if (contextToEventMap.size === 0) {\n        this.#channelToContextToEventMap.delete(channel);\n      }\n    };\n  }\n}\nexports.SubscriptionManager = SubscriptionManager;","map":{"version":3,"names":["protocol_js_1","require","events_js_1","cartesianProduct","a","reduce","b","flatMap","d","map","e","flat","exports","unrollEvents","events","allEvents","Set","addEvents","event","add","ChromiumBidi","BiDiModule","BrowsingContext","Object","values","EventNames","Log","Network","Script","SubscriptionManager","subscriptionPriority","channelToContextToEventMap","Map","browsingContextStorage","constructor","getChannelsSubscribedToEvent","eventMethod","contextId","prioritiesAndChannels","Array","from","keys","channel","priority","getEventSubscriptionPriorityForChannel","filter","sort","#getEventSubscriptionPriorityForChannel","contextToEventMap","get","undefined","maybeTopLevelContextId","findTopLevelContextId","relevantContexts","priorities","context","isCdpEvent","cdpPriority","Cdp","Math","min","p","length","isSubscribedTo","moduleOrEvent","topLevelContext","browserContextToEventMap","id","eventMap","entries","split","at","subscribe","specificEvent","has","set","unsubscribeAll","contextIds","getContext","eventContextPairs","checkUnsubscribe","forEach","unsubscribe","eventName","#checkUnsubscribe","InvalidArgumentException","delete","size"],"sources":["../../../../../src/bidiMapper/modules/session/SubscriptionManager.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}