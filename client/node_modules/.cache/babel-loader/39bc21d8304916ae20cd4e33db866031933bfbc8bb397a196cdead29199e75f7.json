{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NetworkProcessor = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst NetworkUtils_js_1 = require(\"./NetworkUtils.js\");\n/** Dispatches Network domain commands. */\nclass NetworkProcessor {\n  #browsingContextStorage;\n  #networkStorage;\n  constructor(browsingContextStorage, networkStorage) {\n    this.#browsingContextStorage = browsingContextStorage;\n    this.#networkStorage = networkStorage;\n  }\n  async addIntercept(params) {\n    this.#browsingContextStorage.verifyTopLevelContextsList(params.contexts);\n    const urlPatterns = params.urlPatterns ?? [];\n    const parsedUrlPatterns = NetworkProcessor.parseUrlPatterns(urlPatterns);\n    const intercept = this.#networkStorage.addIntercept({\n      urlPatterns: parsedUrlPatterns,\n      phases: params.phases,\n      contexts: params.contexts\n    });\n    await Promise.all(this.#browsingContextStorage.getAllContexts().map(context => {\n      return context.cdpTarget.toggleFetchIfNeeded();\n    }));\n    return {\n      intercept\n    };\n  }\n  async continueRequest(params) {\n    const {\n      url,\n      method,\n      headers: commandHeaders,\n      body,\n      request: networkId\n    } = params;\n    if (params.url !== undefined) {\n      NetworkProcessor.parseUrlString(params.url);\n    }\n    const request = this.#getBlockedRequestOrFail(networkId, [\"beforeRequestSent\" /* Network.InterceptPhase.BeforeRequestSent */]);\n    const headers = (0, NetworkUtils_js_1.cdpFetchHeadersFromBidiNetworkHeaders)(commandHeaders);\n    // TODO: Set / expand.\n    // ; Step 9. cookies\n    await request.continueRequest({\n      url,\n      method,\n      headers,\n      postData: getCdpBodyFromBiDiBytesValue(body)\n    });\n    return {};\n  }\n  async continueResponse(params) {\n    const {\n      request: networkId,\n      statusCode,\n      reasonPhrase,\n      headers\n    } = params;\n    const responseHeaders = (0, NetworkUtils_js_1.cdpFetchHeadersFromBidiNetworkHeaders)(headers);\n    const request = this.#getBlockedRequestOrFail(networkId, [\"authRequired\" /* Network.InterceptPhase.AuthRequired */, \"responseStarted\" /* Network.InterceptPhase.ResponseStarted */]);\n    if (request.interceptPhase === \"authRequired\" /* Network.InterceptPhase.AuthRequired */) {\n      if (params.credentials) {\n        await Promise.all([request.waitNextPhase, request.continueWithAuth({\n          response: 'ProvideCredentials',\n          username: params.credentials.username,\n          password: params.credentials.password\n        })]);\n      } else {\n        // We need to use `ProvideCredentials`\n        // As `Default` may cancel the request\n        await request.continueWithAuth({\n          response: 'ProvideCredentials'\n        });\n        return {};\n      }\n    }\n    if (request.interceptPhase === \"responseStarted\" /* Network.InterceptPhase.ResponseStarted */) {\n      // TODO: Set / expand.\n      // ; Step 10. cookies\n      await request.continueResponse({\n        responseCode: statusCode,\n        responsePhrase: reasonPhrase,\n        responseHeaders\n      });\n    }\n    return {};\n  }\n  async continueWithAuth(params) {\n    const networkId = params.request;\n    const request = this.#getBlockedRequestOrFail(networkId, [\"authRequired\" /* Network.InterceptPhase.AuthRequired */]);\n    let username;\n    let password;\n    if (params.action === 'provideCredentials') {\n      const {\n        credentials\n      } = params;\n      username = credentials.username;\n      password = credentials.password;\n    }\n    const response = (0, NetworkUtils_js_1.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction)(params.action);\n    await request.continueWithAuth({\n      response,\n      username,\n      password\n    });\n    return {};\n  }\n  async failRequest({\n    request: networkId\n  }) {\n    const request = this.#getRequestOrFail(networkId);\n    if (request.interceptPhase === \"authRequired\" /* Network.InterceptPhase.AuthRequired */) {\n      throw new protocol_js_1.InvalidArgumentException(`Request '${networkId}' in 'authRequired' phase cannot be failed`);\n    }\n    if (!request.interceptPhase) {\n      throw new protocol_js_1.NoSuchRequestException(`No blocked request found for network id '${networkId}'`);\n    }\n    await request.failRequest('Failed');\n    return {};\n  }\n  async provideResponse(params) {\n    const {\n      statusCode,\n      reasonPhrase: responsePhrase,\n      headers,\n      body,\n      request: networkId\n    } = params;\n    // TODO: Step 6\n    // https://w3c.github.io/webdriver-bidi/#command-network-continueResponse\n    const responseHeaders = (0, NetworkUtils_js_1.cdpFetchHeadersFromBidiNetworkHeaders)(headers);\n    // TODO: Set / expand.\n    // ; Step 10. cookies\n    // ; Step 11. credentials\n    const request = this.#getBlockedRequestOrFail(networkId, [\"beforeRequestSent\" /* Network.InterceptPhase.BeforeRequestSent */, \"responseStarted\" /* Network.InterceptPhase.ResponseStarted */, \"authRequired\" /* Network.InterceptPhase.AuthRequired */]);\n    // We need to pass through if the request is already in\n    // AuthRequired phase\n    if (request.interceptPhase === \"authRequired\" /* Network.InterceptPhase.AuthRequired */) {\n      // We need to use `ProvideCredentials`\n      // As `Default` may cancel the request\n      await request.continueWithAuth({\n        response: 'ProvideCredentials'\n      });\n      return {};\n    }\n    // If we con't modify the response\n    // Just continue the request\n    if (!body && !headers) {\n      await request.continueRequest();\n      return {};\n    }\n    const responseCode = statusCode ?? request.statusCode ?? 200;\n    await request.provideResponse({\n      responseCode,\n      responsePhrase,\n      responseHeaders,\n      body: getCdpBodyFromBiDiBytesValue(body)\n    });\n    return {};\n  }\n  async removeIntercept(params) {\n    this.#networkStorage.removeIntercept(params.intercept);\n    await Promise.all(this.#browsingContextStorage.getAllContexts().map(context => {\n      return context.cdpTarget.toggleFetchIfNeeded();\n    }));\n    return {};\n  }\n  #getRequestOrFail(id) {\n    const request = this.#networkStorage.getRequestById(id);\n    if (!request) {\n      throw new protocol_js_1.NoSuchRequestException(`Network request with ID '${id}' doesn't exist`);\n    }\n    return request;\n  }\n  #getBlockedRequestOrFail(id, phases) {\n    const request = this.#getRequestOrFail(id);\n    if (!request.interceptPhase) {\n      throw new protocol_js_1.NoSuchRequestException(`No blocked request found for network id '${id}'`);\n    }\n    if (request.interceptPhase && !phases.includes(request.interceptPhase)) {\n      throw new protocol_js_1.InvalidArgumentException(`Blocked request for network id '${id}' is in '${request.interceptPhase}' phase`);\n    }\n    return request;\n  }\n  /**\n   * Attempts to parse the given url.\n   * Throws an InvalidArgumentException if the url is invalid.\n   */\n  static parseUrlString(url) {\n    try {\n      return new URL(url);\n    } catch (error) {\n      throw new protocol_js_1.InvalidArgumentException(`Invalid URL '${url}': ${error}`);\n    }\n  }\n  static parseUrlPatterns(urlPatterns) {\n    return urlPatterns.map(urlPattern => {\n      switch (urlPattern.type) {\n        case 'string':\n          {\n            NetworkProcessor.parseUrlString(urlPattern.pattern);\n            return urlPattern;\n          }\n        case 'pattern':\n          // No params signifies intercept all\n          if (urlPattern.protocol === undefined && urlPattern.hostname === undefined && urlPattern.port === undefined && urlPattern.pathname === undefined && urlPattern.search === undefined) {\n            return urlPattern;\n          }\n          if (urlPattern.protocol) {\n            urlPattern.protocol = unescapeURLPattern(urlPattern.protocol);\n            if (!urlPattern.protocol.match(/^[a-zA-Z+-.]+$/)) {\n              throw new protocol_js_1.InvalidArgumentException('Forbidden characters');\n            }\n          }\n          if (urlPattern.hostname) {\n            urlPattern.hostname = unescapeURLPattern(urlPattern.hostname);\n          }\n          if (urlPattern.port) {\n            urlPattern.port = unescapeURLPattern(urlPattern.port);\n          }\n          if (urlPattern.pathname) {\n            urlPattern.pathname = unescapeURLPattern(urlPattern.pathname);\n            if (urlPattern.pathname[0] !== '/') {\n              urlPattern.pathname = `/${urlPattern.pathname}`;\n            }\n            if (urlPattern.pathname.includes('#') || urlPattern.pathname.includes('?')) {\n              throw new protocol_js_1.InvalidArgumentException('Forbidden characters');\n            }\n          } else if (urlPattern.pathname === '') {\n            urlPattern.pathname = '/';\n          }\n          if (urlPattern.search) {\n            urlPattern.search = unescapeURLPattern(urlPattern.search);\n            if (urlPattern.search[0] !== '?') {\n              urlPattern.search = `?${urlPattern.search}`;\n            }\n            if (urlPattern.search.includes('#')) {\n              throw new protocol_js_1.InvalidArgumentException('Forbidden characters');\n            }\n          }\n          if (urlPattern.protocol === '') {\n            throw new protocol_js_1.InvalidArgumentException(`URL pattern must specify a protocol`);\n          }\n          if (urlPattern.hostname === '') {\n            throw new protocol_js_1.InvalidArgumentException(`URL pattern must specify a hostname`);\n          }\n          if ((urlPattern.hostname?.length ?? 0) > 0) {\n            if (urlPattern.protocol?.match(/^file/i)) {\n              throw new protocol_js_1.InvalidArgumentException(`URL pattern protocol cannot be 'file'`);\n            }\n            if (urlPattern.hostname?.includes(':')) {\n              throw new protocol_js_1.InvalidArgumentException(`URL pattern hostname must not contain a colon`);\n            }\n          }\n          if (urlPattern.port === '') {\n            throw new protocol_js_1.InvalidArgumentException(`URL pattern must specify a port`);\n          }\n          try {\n            new URLPattern(urlPattern);\n          } catch (error) {\n            throw new protocol_js_1.InvalidArgumentException(`${error}`);\n          }\n          return urlPattern;\n      }\n    });\n  }\n}\nexports.NetworkProcessor = NetworkProcessor;\n/**\n * See https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\n */\nfunction unescapeURLPattern(pattern) {\n  const forbidden = new Set(['(', ')', '*', '{', '}']);\n  let result = '';\n  let isEscaped = false;\n  for (const c of pattern) {\n    if (!isEscaped) {\n      if (forbidden.has(c)) {\n        throw new protocol_js_1.InvalidArgumentException('Forbidden characters');\n      }\n      if (c === '\\\\') {\n        isEscaped = true;\n        continue;\n      }\n    }\n    result += c;\n    isEscaped = false;\n  }\n  return result;\n}\nfunction getCdpBodyFromBiDiBytesValue(body) {\n  let parsedBody;\n  if (body?.type === 'string') {\n    parsedBody = btoa(body.value);\n  } else if (body?.type === 'base64') {\n    parsedBody = body.value;\n  }\n  return parsedBody;\n}","map":{"version":3,"names":["protocol_js_1","require","NetworkUtils_js_1","NetworkProcessor","browsingContextStorage","networkStorage","constructor","addIntercept","params","verifyTopLevelContextsList","contexts","urlPatterns","parsedUrlPatterns","parseUrlPatterns","intercept","phases","Promise","all","getAllContexts","map","context","cdpTarget","toggleFetchIfNeeded","continueRequest","url","method","headers","commandHeaders","body","request","networkId","undefined","parseUrlString","getBlockedRequestOrFail","cdpFetchHeadersFromBidiNetworkHeaders","postData","getCdpBodyFromBiDiBytesValue","continueResponse","statusCode","reasonPhrase","responseHeaders","interceptPhase","credentials","waitNextPhase","continueWithAuth","response","username","password","responseCode","responsePhrase","action","cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction","failRequest","getRequestOrFail","InvalidArgumentException","NoSuchRequestException","provideResponse","removeIntercept","#getRequestOrFail","id","getRequestById","#getBlockedRequestOrFail","includes","URL","error","urlPattern","type","pattern","protocol","hostname","port","pathname","search","unescapeURLPattern","match","length","URLPattern","exports","forbidden","Set","result","isEscaped","c","has","parsedBody","btoa","value"],"sources":["../../../../../src/bidiMapper/modules/network/NetworkProcessor.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}