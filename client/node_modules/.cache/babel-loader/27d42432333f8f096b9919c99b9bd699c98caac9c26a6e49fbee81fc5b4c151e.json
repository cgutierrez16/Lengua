{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2022 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __esDecorate = this && this.__esDecorate || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) {\n    if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\");\n    return f;\n  }\n  var kind = contextIn.kind,\n    key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _,\n    done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n    var context = {};\n    for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n    for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n    context.addInitializer = function (f) {\n      if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\");\n      extraInitializers.push(accept(f || null));\n    };\n    var result = (0, decorators[i])(kind === \"accessor\" ? {\n      get: descriptor.get,\n      set: descriptor.set\n    } : descriptor[key], context);\n    if (kind === \"accessor\") {\n      if (result === void 0) continue;\n      if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n      if (_ = accept(result.get)) descriptor.get = _;\n      if (_ = accept(result.set)) descriptor.set = _;\n      if (_ = accept(result.init)) initializers.unshift(_);\n    } else if (_ = accept(result)) {\n      if (kind === \"field\") initializers.unshift(_);else descriptor[key] = _;\n    }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\nvar __runInitializers = this && this.__runInitializers || function (thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n    value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\nvar __addDisposableResource = this && this.__addDisposableResource || function (env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({\n      value: value,\n      dispose: dispose,\n      async: async\n    });\n  } else if (async) {\n    env.stack.push({\n      async: true\n    });\n  }\n  return value;\n};\nvar __disposeResources = this && this.__disposeResources || function (SuppressedError) {\n  return function (env) {\n    function fail(e) {\n      env.error = env.hasError ? new SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n      env.hasError = true;\n    }\n    function next() {\n      while (env.stack.length) {\n        var rec = env.stack.pop();\n        try {\n          var result = rec.dispose && rec.dispose.call(rec.value);\n          if (rec.async) return Promise.resolve(result).then(next, function (e) {\n            fail(e);\n            return next();\n          });\n        } catch (e) {\n          fail(e);\n        }\n      }\n      if (env.hasError) throw env.error;\n    }\n    return next();\n  };\n}(typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n});\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BidiPage = void 0;\nconst rxjs_js_1 = require(\"../../third_party/rxjs/rxjs.js\");\nconst Page_js_1 = require(\"../api/Page.js\");\nconst Accessibility_js_1 = require(\"../cdp/Accessibility.js\");\nconst Coverage_js_1 = require(\"../cdp/Coverage.js\");\nconst EmulationManager_js_1 = require(\"../cdp/EmulationManager.js\");\nconst Tracing_js_1 = require(\"../cdp/Tracing.js\");\nconst Errors_js_1 = require(\"../common/Errors.js\");\nconst EventEmitter_js_1 = require(\"../common/EventEmitter.js\");\nconst util_js_1 = require(\"../common/util.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst decorators_js_1 = require(\"../util/decorators.js\");\nconst ErrorLike_js_1 = require(\"../util/ErrorLike.js\");\nconst Frame_js_1 = require(\"./Frame.js\");\nconst Input_js_1 = require(\"./Input.js\");\nconst util_js_2 = require(\"./util.js\");\n/**\n * @internal\n */\nlet BidiPage = (() => {\n  let _classSuper = Page_js_1.Page;\n  let _instanceExtraInitializers = [];\n  let _trustedEmitter_decorators;\n  let _trustedEmitter_initializers = [];\n  return class BidiPage extends _classSuper {\n    static {\n      const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(_classSuper[Symbol.metadata] ?? null) : void 0;\n      _trustedEmitter_decorators = [(0, decorators_js_1.bubble)()];\n      __esDecorate(this, null, _trustedEmitter_decorators, {\n        kind: \"accessor\",\n        name: \"trustedEmitter\",\n        static: false,\n        private: false,\n        access: {\n          has: obj => \"trustedEmitter\" in obj,\n          get: obj => obj.trustedEmitter,\n          set: (obj, value) => {\n            obj.trustedEmitter = value;\n          }\n        },\n        metadata: _metadata\n      }, _trustedEmitter_initializers, _instanceExtraInitializers);\n      if (_metadata) Object.defineProperty(this, Symbol.metadata, {\n        enumerable: true,\n        configurable: true,\n        writable: true,\n        value: _metadata\n      });\n    }\n    static from(browserContext, browsingContext) {\n      const page = new BidiPage(browserContext, browsingContext);\n      page.#initialize();\n      return page;\n    }\n    #trustedEmitter_accessor_storage = (__runInitializers(this, _instanceExtraInitializers), __runInitializers(this, _trustedEmitter_initializers, new EventEmitter_js_1.EventEmitter()));\n    get trustedEmitter() {\n      return this.#trustedEmitter_accessor_storage;\n    }\n    set trustedEmitter(value) {\n      this.#trustedEmitter_accessor_storage = value;\n    }\n    #browserContext;\n    #frame;\n    #viewport = null;\n    #workers = new Set();\n    keyboard;\n    mouse;\n    touchscreen;\n    accessibility;\n    tracing;\n    coverage;\n    #cdpEmulationManager;\n    _client() {\n      return this.#frame.client;\n    }\n    constructor(browserContext, browsingContext) {\n      super();\n      this.#browserContext = browserContext;\n      this.#frame = Frame_js_1.BidiFrame.from(this, browsingContext);\n      this.#cdpEmulationManager = new EmulationManager_js_1.EmulationManager(this.#frame.client);\n      this.accessibility = new Accessibility_js_1.Accessibility(this.#frame.client);\n      this.tracing = new Tracing_js_1.Tracing(this.#frame.client);\n      this.coverage = new Coverage_js_1.Coverage(this.#frame.client);\n      this.keyboard = new Input_js_1.BidiKeyboard(this);\n      this.mouse = new Input_js_1.BidiMouse(this);\n      this.touchscreen = new Input_js_1.BidiTouchscreen(this);\n    }\n    #initialize() {\n      this.#frame.browsingContext.on('closed', () => {\n        this.trustedEmitter.emit(\"close\" /* PageEvent.Close */, undefined);\n        this.trustedEmitter.removeAllListeners();\n      });\n      this.trustedEmitter.on(\"workercreated\" /* PageEvent.WorkerCreated */, worker => {\n        this.#workers.add(worker);\n      });\n      this.trustedEmitter.on(\"workerdestroyed\" /* PageEvent.WorkerDestroyed */, worker => {\n        this.#workers.delete(worker);\n      });\n    }\n    async setUserAgent(userAgent, userAgentMetadata) {\n      // TODO: handle CDP-specific cases such as mprach.\n      await this._client().send('Network.setUserAgentOverride', {\n        userAgent: userAgent,\n        userAgentMetadata: userAgentMetadata\n      });\n    }\n    async setBypassCSP(enabled) {\n      // TODO: handle CDP-specific cases such as mprach.\n      await this._client().send('Page.setBypassCSP', {\n        enabled\n      });\n    }\n    async queryObjects(prototypeHandle) {\n      (0, assert_js_1.assert)(!prototypeHandle.disposed, 'Prototype JSHandle is disposed!');\n      (0, assert_js_1.assert)(prototypeHandle.id, 'Prototype JSHandle must not be referencing primitive value');\n      const response = await this.#frame.client.send('Runtime.queryObjects', {\n        prototypeObjectId: prototypeHandle.id\n      });\n      return this.#frame.mainRealm().createHandle({\n        type: 'array',\n        handle: response.objects.objectId\n      });\n    }\n    browser() {\n      return this.browserContext().browser();\n    }\n    browserContext() {\n      return this.#browserContext;\n    }\n    mainFrame() {\n      return this.#frame;\n    }\n    async focusedFrame() {\n      const env_1 = {\n        stack: [],\n        error: void 0,\n        hasError: false\n      };\n      try {\n        const handle = __addDisposableResource(env_1, await this.mainFrame().isolatedRealm().evaluateHandle(() => {\n          let win = window;\n          while (win.document.activeElement instanceof win.HTMLIFrameElement || win.document.activeElement instanceof win.HTMLFrameElement) {\n            if (win.document.activeElement.contentWindow === null) {\n              break;\n            }\n            win = win.document.activeElement.contentWindow;\n          }\n          return win;\n        }), false);\n        const value = handle.remoteValue();\n        (0, assert_js_1.assert)(value.type === 'window');\n        const frame = this.frames().find(frame => {\n          return frame._id === value.value.context;\n        });\n        (0, assert_js_1.assert)(frame);\n        return frame;\n      } catch (e_1) {\n        env_1.error = e_1;\n        env_1.hasError = true;\n      } finally {\n        __disposeResources(env_1);\n      }\n    }\n    frames() {\n      const frames = [this.#frame];\n      for (const frame of frames) {\n        frames.push(...frame.childFrames());\n      }\n      return frames;\n    }\n    isClosed() {\n      return this.#frame.detached;\n    }\n    async close(options) {\n      try {\n        await this.#frame.browsingContext.close(options?.runBeforeUnload);\n      } catch {\n        return;\n      }\n    }\n    async reload(options = {}) {\n      const [response] = await Promise.all([this.#frame.waitForNavigation(options), this.#frame.browsingContext.reload()]).catch((0, util_js_2.rewriteNavigationError)(this.url(), options.timeout ?? this._timeoutSettings.navigationTimeout()));\n      return response;\n    }\n    setDefaultNavigationTimeout(timeout) {\n      this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n    }\n    setDefaultTimeout(timeout) {\n      this._timeoutSettings.setDefaultTimeout(timeout);\n    }\n    getDefaultTimeout() {\n      return this._timeoutSettings.timeout();\n    }\n    isJavaScriptEnabled() {\n      return this.#cdpEmulationManager.javascriptEnabled;\n    }\n    async setGeolocation(options) {\n      return await this.#cdpEmulationManager.setGeolocation(options);\n    }\n    async setJavaScriptEnabled(enabled) {\n      return await this.#cdpEmulationManager.setJavaScriptEnabled(enabled);\n    }\n    async emulateMediaType(type) {\n      return await this.#cdpEmulationManager.emulateMediaType(type);\n    }\n    async emulateCPUThrottling(factor) {\n      return await this.#cdpEmulationManager.emulateCPUThrottling(factor);\n    }\n    async emulateMediaFeatures(features) {\n      return await this.#cdpEmulationManager.emulateMediaFeatures(features);\n    }\n    async emulateTimezone(timezoneId) {\n      return await this.#cdpEmulationManager.emulateTimezone(timezoneId);\n    }\n    async emulateIdleState(overrides) {\n      return await this.#cdpEmulationManager.emulateIdleState(overrides);\n    }\n    async emulateVisionDeficiency(type) {\n      return await this.#cdpEmulationManager.emulateVisionDeficiency(type);\n    }\n    async setViewport(viewport) {\n      if (!this.browser().cdpSupported) {\n        await this.#frame.browsingContext.setViewport({\n          viewport: viewport.width && viewport.height ? {\n            width: viewport.width,\n            height: viewport.height\n          } : null,\n          devicePixelRatio: viewport.deviceScaleFactor ? viewport.deviceScaleFactor : null\n        });\n        this.#viewport = viewport;\n        return;\n      }\n      const needsReload = await this.#cdpEmulationManager.emulateViewport(viewport);\n      this.#viewport = viewport;\n      if (needsReload) {\n        await this.reload();\n      }\n    }\n    viewport() {\n      return this.#viewport;\n    }\n    async pdf(options = {}) {\n      const {\n        timeout: ms = this._timeoutSettings.timeout(),\n        path = undefined\n      } = options;\n      const {\n        printBackground: background,\n        margin,\n        landscape,\n        width,\n        height,\n        pageRanges: ranges,\n        scale,\n        preferCSSPageSize\n      } = (0, util_js_1.parsePDFOptions)(options, 'cm');\n      const pageRanges = ranges ? ranges.split(', ') : [];\n      await (0, rxjs_js_1.firstValueFrom)((0, rxjs_js_1.from)(this.mainFrame().isolatedRealm().evaluate(() => {\n        return document.fonts.ready;\n      })).pipe((0, rxjs_js_1.raceWith)((0, util_js_1.timeout)(ms))));\n      const data = await (0, rxjs_js_1.firstValueFrom)((0, rxjs_js_1.from)(this.#frame.browsingContext.print({\n        background,\n        margin,\n        orientation: landscape ? 'landscape' : 'portrait',\n        page: {\n          width,\n          height\n        },\n        pageRanges,\n        scale,\n        shrinkToFit: !preferCSSPageSize\n      })).pipe((0, rxjs_js_1.raceWith)((0, util_js_1.timeout)(ms))));\n      const buffer = Buffer.from(data, 'base64');\n      await this._maybeWriteBufferToFile(path, buffer);\n      return buffer;\n    }\n    async createPDFStream(options) {\n      const buffer = await this.pdf(options);\n      return new ReadableStream({\n        start(controller) {\n          controller.enqueue(buffer);\n          controller.close();\n        }\n      });\n    }\n    async _screenshot(options) {\n      const {\n        clip,\n        type,\n        captureBeyondViewport,\n        quality\n      } = options;\n      if (options.omitBackground !== undefined && options.omitBackground) {\n        throw new Errors_js_1.UnsupportedOperation(`BiDi does not support 'omitBackground'.`);\n      }\n      if (options.optimizeForSpeed !== undefined && options.optimizeForSpeed) {\n        throw new Errors_js_1.UnsupportedOperation(`BiDi does not support 'optimizeForSpeed'.`);\n      }\n      if (options.fromSurface !== undefined && !options.fromSurface) {\n        throw new Errors_js_1.UnsupportedOperation(`BiDi does not support 'fromSurface'.`);\n      }\n      if (clip !== undefined && clip.scale !== undefined && clip.scale !== 1) {\n        throw new Errors_js_1.UnsupportedOperation(`BiDi does not support 'scale' in 'clip'.`);\n      }\n      let box;\n      if (clip) {\n        if (captureBeyondViewport) {\n          box = clip;\n        } else {\n          // The clip is always with respect to the document coordinates, so we\n          // need to convert this to viewport coordinates when we aren't capturing\n          // beyond the viewport.\n          const [pageLeft, pageTop] = await this.evaluate(() => {\n            if (!window.visualViewport) {\n              throw new Error('window.visualViewport is not supported.');\n            }\n            return [window.visualViewport.pageLeft, window.visualViewport.pageTop];\n          });\n          box = {\n            ...clip,\n            x: clip.x - pageLeft,\n            y: clip.y - pageTop\n          };\n        }\n      }\n      const data = await this.#frame.browsingContext.captureScreenshot({\n        origin: captureBeyondViewport ? 'document' : 'viewport',\n        format: {\n          type: `image/${type}`,\n          ...(quality !== undefined ? {\n            quality: quality / 100\n          } : {})\n        },\n        ...(box ? {\n          clip: {\n            type: 'box',\n            ...box\n          }\n        } : {})\n      });\n      return data;\n    }\n    async createCDPSession() {\n      return await this.#frame.createCDPSession();\n    }\n    async bringToFront() {\n      await this.#frame.browsingContext.activate();\n    }\n    async evaluateOnNewDocument(pageFunction, ...args) {\n      const expression = evaluationExpression(pageFunction, ...args);\n      const script = await this.#frame.browsingContext.addPreloadScript(expression);\n      return {\n        identifier: script\n      };\n    }\n    async removeScriptToEvaluateOnNewDocument(id) {\n      await this.#frame.browsingContext.removePreloadScript(id);\n    }\n    async exposeFunction(name, pptrFunction) {\n      return await this.mainFrame().exposeFunction(name, 'default' in pptrFunction ? pptrFunction.default : pptrFunction);\n    }\n    isDragInterceptionEnabled() {\n      return false;\n    }\n    async setCacheEnabled(enabled) {\n      // TODO: handle CDP-specific cases such as mprach.\n      await this._client().send('Network.setCacheDisabled', {\n        cacheDisabled: !enabled\n      });\n    }\n    async cookies(...urls) {\n      const normalizedUrls = (urls.length ? urls : [this.url()]).map(url => {\n        return new URL(url);\n      });\n      const cookies = await this.#frame.browsingContext.getCookies();\n      return cookies.map(cookie => {\n        return bidiToPuppeteerCookie(cookie);\n      }).filter(cookie => {\n        return normalizedUrls.some(url => {\n          return testUrlMatchCookie(cookie, url);\n        });\n      });\n    }\n    isServiceWorkerBypassed() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    target() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    waitForFileChooser() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    workers() {\n      return [...this.#workers];\n    }\n    #userInterception;\n    async setRequestInterception(enable) {\n      this.#userInterception = await this.#toggleInterception([\"beforeRequestSent\" /* Bidi.Network.InterceptPhase.BeforeRequestSent */], this.#userInterception, enable);\n    }\n    /**\n     * @internal\n     */\n    _extraHTTPHeaders = {};\n    #extraHeadersInterception;\n    async setExtraHTTPHeaders(headers) {\n      const extraHTTPHeaders = {};\n      for (const [key, value] of Object.entries(headers)) {\n        (0, assert_js_1.assert)((0, util_js_1.isString)(value), `Expected value of header \"${key}\" to be String, but \"${typeof value}\" is found.`);\n        extraHTTPHeaders[key.toLowerCase()] = value;\n      }\n      this._extraHTTPHeaders = extraHTTPHeaders;\n      this.#extraHeadersInterception = await this.#toggleInterception([\"beforeRequestSent\" /* Bidi.Network.InterceptPhase.BeforeRequestSent */], this.#extraHeadersInterception, Boolean(Object.keys(this._extraHTTPHeaders).length));\n    }\n    /**\n     * @internal\n     */\n    _credentials = null;\n    #authInterception;\n    async authenticate(credentials) {\n      this.#authInterception = await this.#toggleInterception([\"authRequired\" /* Bidi.Network.InterceptPhase.AuthRequired */], this.#authInterception, Boolean(credentials));\n      this._credentials = credentials;\n    }\n    async #toggleInterception(phases, interception, expected) {\n      if (expected && !interception) {\n        return await this.#frame.browsingContext.addIntercept({\n          phases\n        });\n      } else if (!expected && interception) {\n        await this.#frame.browsingContext.userContext.browser.removeIntercept(interception);\n        return;\n      }\n      return interception;\n    }\n    setDragInterception() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    setBypassServiceWorker() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    setOfflineMode() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    emulateNetworkConditions() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    async setCookie(...cookies) {\n      const pageURL = this.url();\n      const pageUrlStartsWithHTTP = pageURL.startsWith('http');\n      for (const cookie of cookies) {\n        let cookieUrl = cookie.url || '';\n        if (!cookieUrl && pageUrlStartsWithHTTP) {\n          cookieUrl = pageURL;\n        }\n        (0, assert_js_1.assert)(cookieUrl !== 'about:blank', `Blank page can not have cookie \"${cookie.name}\"`);\n        (0, assert_js_1.assert)(!String.prototype.startsWith.call(cookieUrl || '', 'data:'), `Data URL page can not have cookie \"${cookie.name}\"`);\n        const normalizedUrl = URL.canParse(cookieUrl) ? new URL(cookieUrl) : undefined;\n        const domain = cookie.domain ?? normalizedUrl?.hostname;\n        (0, assert_js_1.assert)(domain !== undefined, `At least one of the url and domain needs to be specified`);\n        const bidiCookie = {\n          domain: domain,\n          name: cookie.name,\n          value: {\n            type: 'string',\n            value: cookie.value\n          },\n          ...(cookie.path !== undefined ? {\n            path: cookie.path\n          } : {}),\n          ...(cookie.httpOnly !== undefined ? {\n            httpOnly: cookie.httpOnly\n          } : {}),\n          ...(cookie.secure !== undefined ? {\n            secure: cookie.secure\n          } : {}),\n          ...(cookie.sameSite !== undefined ? {\n            sameSite: convertCookiesSameSiteCdpToBiDi(cookie.sameSite)\n          } : {}),\n          ...(cookie.expires !== undefined ? {\n            expiry: cookie.expires\n          } : {}),\n          // Chrome-specific properties.\n          ...cdpSpecificCookiePropertiesFromPuppeteerToBidi(cookie, 'sameParty', 'sourceScheme', 'priority', 'url')\n        };\n        if (cookie.partitionKey !== undefined) {\n          await this.browserContext().userContext.setCookie(bidiCookie, cookie.partitionKey);\n        } else {\n          await this.#frame.browsingContext.setCookie(bidiCookie);\n        }\n      }\n    }\n    async deleteCookie(...cookies) {\n      await Promise.all(cookies.map(async deleteCookieRequest => {\n        const cookieUrl = deleteCookieRequest.url ?? this.url();\n        const normalizedUrl = URL.canParse(cookieUrl) ? new URL(cookieUrl) : undefined;\n        const domain = deleteCookieRequest.domain ?? normalizedUrl?.hostname;\n        (0, assert_js_1.assert)(domain !== undefined, `At least one of the url and domain needs to be specified`);\n        const filter = {\n          domain: domain,\n          name: deleteCookieRequest.name,\n          ...(deleteCookieRequest.path !== undefined ? {\n            path: deleteCookieRequest.path\n          } : {})\n        };\n        await this.#frame.browsingContext.deleteCookie(filter);\n      }));\n    }\n    async removeExposedFunction(name) {\n      await this.#frame.removeExposedFunction(name);\n    }\n    metrics() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n    async goBack(options = {}) {\n      return await this.#go(-1, options);\n    }\n    async goForward(options = {}) {\n      return await this.#go(1, options);\n    }\n    async #go(delta, options) {\n      try {\n        const [response] = await Promise.all([this.waitForNavigation(options), this.#frame.browsingContext.traverseHistory(delta)]);\n        return response;\n      } catch (error) {\n        // TODO: waitForNavigation should be cancelled if an error happens.\n        if ((0, ErrorLike_js_1.isErrorLike)(error)) {\n          if (error.message.includes('no such history entry')) {\n            return null;\n          }\n        }\n        throw error;\n      }\n    }\n    waitForDevicePrompt() {\n      throw new Errors_js_1.UnsupportedOperation();\n    }\n  };\n})();\nexports.BidiPage = BidiPage;\nfunction evaluationExpression(fun, ...args) {\n  return `() => {${(0, util_js_1.evaluationString)(fun, ...args)}}`;\n}\n/**\n * Check domains match.\n * According to cookies spec, this check should match subdomains as well, but CDP\n * implementation does not do that, so this method matches only the exact domains, not\n * what is written in the spec:\n * https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.3\n */\nfunction testUrlMatchCookieHostname(cookie, normalizedUrl) {\n  const cookieDomain = cookie.domain.toLowerCase();\n  const urlHostname = normalizedUrl.hostname.toLowerCase();\n  return cookieDomain === urlHostname;\n}\n/**\n * Check paths match.\n * Spec: https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.4\n */\nfunction testUrlMatchCookiePath(cookie, normalizedUrl) {\n  const uriPath = normalizedUrl.pathname;\n  const cookiePath = cookie.path;\n  if (uriPath === cookiePath) {\n    // The cookie-path and the request-path are identical.\n    return true;\n  }\n  if (uriPath.startsWith(cookiePath)) {\n    // The cookie-path is a prefix of the request-path.\n    if (cookiePath.endsWith('/')) {\n      // The last character of the cookie-path is %x2F (\"/\").\n      return true;\n    }\n    if (uriPath[cookiePath.length] === '/') {\n      // The first character of the request-path that is not included in the cookie-path\n      // is a %x2F (\"/\") character.\n      return true;\n    }\n  }\n  return false;\n}\n/**\n * Checks the cookie matches the URL according to the spec:\n */\nfunction testUrlMatchCookie(cookie, url) {\n  const normalizedUrl = new URL(url);\n  (0, assert_js_1.assert)(cookie !== undefined);\n  if (!testUrlMatchCookieHostname(cookie, normalizedUrl)) {\n    return false;\n  }\n  return testUrlMatchCookiePath(cookie, normalizedUrl);\n}\nfunction bidiToPuppeteerCookie(bidiCookie) {\n  return {\n    name: bidiCookie.name,\n    // Presents binary value as base64 string.\n    value: bidiCookie.value.value,\n    domain: bidiCookie.domain,\n    path: bidiCookie.path,\n    size: bidiCookie.size,\n    httpOnly: bidiCookie.httpOnly,\n    secure: bidiCookie.secure,\n    sameSite: convertCookiesSameSiteBiDiToCdp(bidiCookie.sameSite),\n    expires: bidiCookie.expiry ?? -1,\n    session: bidiCookie.expiry === undefined || bidiCookie.expiry <= 0,\n    // Extending with CDP-specific properties with `goog:` prefix.\n    ...cdpSpecificCookiePropertiesFromBidiToPuppeteer(bidiCookie, 'sameParty', 'sourceScheme', 'partitionKey', 'partitionKeyOpaque', 'priority')\n  };\n}\nconst CDP_SPECIFIC_PREFIX = 'goog:';\n/**\n * Gets CDP-specific properties from the BiDi cookie and returns them as a new object.\n */\nfunction cdpSpecificCookiePropertiesFromBidiToPuppeteer(bidiCookie, ...propertyNames) {\n  const result = {};\n  for (const property of propertyNames) {\n    if (bidiCookie[CDP_SPECIFIC_PREFIX + property] !== undefined) {\n      result[property] = bidiCookie[CDP_SPECIFIC_PREFIX + property];\n    }\n  }\n  return result;\n}\n/**\n * Gets CDP-specific properties from the cookie, adds CDP-specific prefixes and returns\n * them as a new object which can be used in BiDi.\n */\nfunction cdpSpecificCookiePropertiesFromPuppeteerToBidi(cookieParam, ...propertyNames) {\n  const result = {};\n  for (const property of propertyNames) {\n    if (cookieParam[property] !== undefined) {\n      result[CDP_SPECIFIC_PREFIX + property] = cookieParam[property];\n    }\n  }\n  return result;\n}\nfunction convertCookiesSameSiteBiDiToCdp(sameSite) {\n  return sameSite === 'strict' ? 'Strict' : sameSite === 'lax' ? 'Lax' : 'None';\n}\nfunction convertCookiesSameSiteCdpToBiDi(sameSite) {\n  return sameSite === 'Strict' ? \"strict\" /* Bidi.Network.SameSite.Strict */ : sameSite === 'Lax' ? \"lax\" /* Bidi.Network.SameSite.Lax */ : \"none\" /* Bidi.Network.SameSite.None */;\n}","map":{"version":3,"names":["rxjs_js_1","require","Page_js_1","Accessibility_js_1","Coverage_js_1","EmulationManager_js_1","Tracing_js_1","Errors_js_1","EventEmitter_js_1","util_js_1","assert_js_1","decorators_js_1","ErrorLike_js_1","Frame_js_1","Input_js_1","util_js_2","BidiPage","Page","_classSuper","bubble","__esDecorate","_trustedEmitter_decorators","kind","name","static","private","access","has","obj","get","trustedEmitter","set","value","metadata","_metadata","_trustedEmitter_initializers","_instanceExtraInitializers","from","browserContext","browsingContext","page","initialize","trustedEmitter_accessor_storage","__runInitializers","EventEmitter","frame","viewport","workers","Set","keyboard","mouse","touchscreen","accessibility","tracing","coverage","cdpEmulationManager","_client","client","constructor","BidiFrame","EmulationManager","Accessibility","Tracing","Coverage","BidiKeyboard","BidiMouse","BidiTouchscreen","#initialize","on","emit","undefined","removeAllListeners","worker","add","delete","setUserAgent","userAgent","userAgentMetadata","send","setBypassCSP","enabled","queryObjects","prototypeHandle","assert","disposed","id","response","prototypeObjectId","mainRealm","createHandle","type","handle","objects","objectId","browser","mainFrame","focusedFrame","__addDisposableResource","env_1","isolatedRealm","evaluateHandle","win","window","document","activeElement","HTMLIFrameElement","HTMLFrameElement","contentWindow","remoteValue","frames","find","_id","context","push","childFrames","isClosed","detached","close","options","runBeforeUnload","reload","Promise","all","waitForNavigation","catch","rewriteNavigationError","url","timeout","_timeoutSettings","navigationTimeout","setDefaultNavigationTimeout","setDefaultTimeout","getDefaultTimeout","isJavaScriptEnabled","javascriptEnabled","setGeolocation","setJavaScriptEnabled","emulateMediaType","emulateCPUThrottling","factor","emulateMediaFeatures","features","emulateTimezone","timezoneId","emulateIdleState","overrides","emulateVisionDeficiency","setViewport","cdpSupported","width","height","devicePixelRatio","deviceScaleFactor","needsReload","emulateViewport","pdf","ms","path","printBackground","background","margin","landscape","pageRanges","ranges","scale","preferCSSPageSize","parsePDFOptions","split","firstValueFrom","evaluate","fonts","ready","pipe","raceWith","data","print","orientation","shrinkToFit","buffer","Buffer","_maybeWriteBufferToFile","createPDFStream","ReadableStream","start","controller","enqueue","_screenshot","clip","captureBeyondViewport","quality","omitBackground","UnsupportedOperation","optimizeForSpeed","fromSurface","box","pageLeft","pageTop","visualViewport","Error","x","y","captureScreenshot","origin","format","createCDPSession","bringToFront","activate","evaluateOnNewDocument","pageFunction","args","expression","evaluationExpression","script","addPreloadScript","identifier","removeScriptToEvaluateOnNewDocument","removePreloadScript","exposeFunction","pptrFunction","default","isDragInterceptionEnabled","setCacheEnabled","cacheDisabled","cookies","urls","normalizedUrls","length","map","URL","getCookies","cookie","bidiToPuppeteerCookie","filter","some","testUrlMatchCookie","isServiceWorkerBypassed","target","waitForFileChooser","userInterception","setRequestInterception","enable","toggleInterception","_extraHTTPHeaders","extraHeadersInterception","setExtraHTTPHeaders","headers","extraHTTPHeaders","key","Object","entries","isString","toLowerCase","Boolean","keys","_credentials","authInterception","authenticate","credentials","#toggleInterception","phases","interception","expected","addIntercept","userContext","removeIntercept","setDragInterception","setBypassServiceWorker","setOfflineMode","emulateNetworkConditions","setCookie","pageURL","pageUrlStartsWithHTTP","startsWith","cookieUrl","String","prototype","call","normalizedUrl","canParse","domain","hostname","bidiCookie","httpOnly","secure","sameSite","convertCookiesSameSiteCdpToBiDi","expires","expiry","cdpSpecificCookiePropertiesFromPuppeteerToBidi","partitionKey","deleteCookie","deleteCookieRequest","removeExposedFunction","metrics","goBack","go","goForward","#go","delta","traverseHistory","error","isErrorLike","message","includes","waitForDevicePrompt","exports","fun","evaluationString","testUrlMatchCookieHostname","cookieDomain","urlHostname","testUrlMatchCookiePath","uriPath","pathname","cookiePath","endsWith","size","convertCookiesSameSiteBiDiToCdp","session","cdpSpecificCookiePropertiesFromBidiToPuppeteer","CDP_SPECIFIC_PREFIX","propertyNames","result","property","cookieParam"],"sources":["/Users/carlosgutierrez/Documents/React/spanish/node_modules/puppeteer-core/src/bidi/Page.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2022 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as Bidi from 'chromium-bidi/lib/cjs/protocol/protocol.js';\nimport type Protocol from 'devtools-protocol';\n\nimport {firstValueFrom, from, raceWith} from '../../third_party/rxjs/rxjs.js';\nimport type {CDPSession} from '../api/CDPSession.js';\nimport type {BoundingBox} from '../api/ElementHandle.js';\nimport type {WaitForOptions} from '../api/Frame.js';\nimport type {HTTPResponse} from '../api/HTTPResponse.js';\nimport type {\n  Credentials,\n  GeolocationOptions,\n  MediaFeature,\n  PageEvents,\n} from '../api/Page.js';\nimport {\n  Page,\n  PageEvent,\n  type NewDocumentScriptEvaluation,\n  type ScreenshotOptions,\n} from '../api/Page.js';\nimport {Accessibility} from '../cdp/Accessibility.js';\nimport {Coverage} from '../cdp/Coverage.js';\nimport {EmulationManager} from '../cdp/EmulationManager.js';\nimport {Tracing} from '../cdp/Tracing.js';\nimport type {\n  Cookie,\n  CookieParam,\n  CookieSameSite,\n  DeleteCookiesRequest,\n} from '../common/Cookie.js';\nimport {UnsupportedOperation} from '../common/Errors.js';\nimport {EventEmitter} from '../common/EventEmitter.js';\nimport type {PDFOptions} from '../common/PDFOptions.js';\nimport type {Awaitable} from '../common/types.js';\nimport {\n  evaluationString,\n  isString,\n  parsePDFOptions,\n  timeout,\n} from '../common/util.js';\nimport type {Viewport} from '../common/Viewport.js';\nimport {assert} from '../util/assert.js';\nimport {bubble} from '../util/decorators.js';\nimport {isErrorLike} from '../util/ErrorLike.js';\n\nimport type {BidiBrowser} from './Browser.js';\nimport type {BidiBrowserContext} from './BrowserContext.js';\nimport type {BidiCdpSession} from './CDPSession.js';\nimport type {BrowsingContext} from './core/BrowsingContext.js';\nimport {BidiFrame} from './Frame.js';\nimport type {BidiHTTPResponse} from './HTTPResponse.js';\nimport {BidiKeyboard, BidiMouse, BidiTouchscreen} from './Input.js';\nimport type {BidiJSHandle} from './JSHandle.js';\nimport {rewriteNavigationError} from './util.js';\nimport type {BidiWebWorker} from './WebWorker.js';\n\n/**\n * @internal\n */\nexport class BidiPage extends Page {\n  static from(\n    browserContext: BidiBrowserContext,\n    browsingContext: BrowsingContext\n  ): BidiPage {\n    const page = new BidiPage(browserContext, browsingContext);\n    page.#initialize();\n    return page;\n  }\n\n  @bubble()\n  accessor trustedEmitter = new EventEmitter<PageEvents>();\n\n  readonly #browserContext: BidiBrowserContext;\n  readonly #frame: BidiFrame;\n  #viewport: Viewport | null = null;\n  readonly #workers = new Set<BidiWebWorker>();\n\n  readonly keyboard: BidiKeyboard;\n  readonly mouse: BidiMouse;\n  readonly touchscreen: BidiTouchscreen;\n  readonly accessibility: Accessibility;\n  readonly tracing: Tracing;\n  readonly coverage: Coverage;\n  readonly #cdpEmulationManager: EmulationManager;\n\n  _client(): BidiCdpSession {\n    return this.#frame.client;\n  }\n\n  private constructor(\n    browserContext: BidiBrowserContext,\n    browsingContext: BrowsingContext\n  ) {\n    super();\n    this.#browserContext = browserContext;\n    this.#frame = BidiFrame.from(this, browsingContext);\n\n    this.#cdpEmulationManager = new EmulationManager(this.#frame.client);\n    this.accessibility = new Accessibility(this.#frame.client);\n    this.tracing = new Tracing(this.#frame.client);\n    this.coverage = new Coverage(this.#frame.client);\n    this.keyboard = new BidiKeyboard(this);\n    this.mouse = new BidiMouse(this);\n    this.touchscreen = new BidiTouchscreen(this);\n  }\n\n  #initialize() {\n    this.#frame.browsingContext.on('closed', () => {\n      this.trustedEmitter.emit(PageEvent.Close, undefined);\n      this.trustedEmitter.removeAllListeners();\n    });\n\n    this.trustedEmitter.on(PageEvent.WorkerCreated, worker => {\n      this.#workers.add(worker as BidiWebWorker);\n    });\n    this.trustedEmitter.on(PageEvent.WorkerDestroyed, worker => {\n      this.#workers.delete(worker as BidiWebWorker);\n    });\n  }\n\n  override async setUserAgent(\n    userAgent: string,\n    userAgentMetadata?: Protocol.Emulation.UserAgentMetadata | undefined\n  ): Promise<void> {\n    // TODO: handle CDP-specific cases such as mprach.\n    await this._client().send('Network.setUserAgentOverride', {\n      userAgent: userAgent,\n      userAgentMetadata: userAgentMetadata,\n    });\n  }\n\n  override async setBypassCSP(enabled: boolean): Promise<void> {\n    // TODO: handle CDP-specific cases such as mprach.\n    await this._client().send('Page.setBypassCSP', {enabled});\n  }\n\n  override async queryObjects<Prototype>(\n    prototypeHandle: BidiJSHandle<Prototype>\n  ): Promise<BidiJSHandle<Prototype[]>> {\n    assert(!prototypeHandle.disposed, 'Prototype JSHandle is disposed!');\n    assert(\n      prototypeHandle.id,\n      'Prototype JSHandle must not be referencing primitive value'\n    );\n    const response = await this.#frame.client.send('Runtime.queryObjects', {\n      prototypeObjectId: prototypeHandle.id,\n    });\n    return this.#frame.mainRealm().createHandle({\n      type: 'array',\n      handle: response.objects.objectId,\n    }) as BidiJSHandle<Prototype[]>;\n  }\n\n  override browser(): BidiBrowser {\n    return this.browserContext().browser();\n  }\n\n  override browserContext(): BidiBrowserContext {\n    return this.#browserContext;\n  }\n\n  override mainFrame(): BidiFrame {\n    return this.#frame;\n  }\n\n  async focusedFrame(): Promise<BidiFrame> {\n    using handle = (await this.mainFrame()\n      .isolatedRealm()\n      .evaluateHandle(() => {\n        let win = window;\n        while (\n          win.document.activeElement instanceof win.HTMLIFrameElement ||\n          win.document.activeElement instanceof win.HTMLFrameElement\n        ) {\n          if (win.document.activeElement.contentWindow === null) {\n            break;\n          }\n          win = win.document.activeElement.contentWindow as typeof win;\n        }\n        return win;\n      })) as BidiJSHandle<Window & typeof globalThis>;\n    const value = handle.remoteValue();\n    assert(value.type === 'window');\n    const frame = this.frames().find(frame => {\n      return frame._id === value.value.context;\n    });\n    assert(frame);\n    return frame;\n  }\n\n  override frames(): BidiFrame[] {\n    const frames = [this.#frame];\n    for (const frame of frames) {\n      frames.push(...frame.childFrames());\n    }\n    return frames;\n  }\n\n  override isClosed(): boolean {\n    return this.#frame.detached;\n  }\n\n  override async close(options?: {runBeforeUnload?: boolean}): Promise<void> {\n    try {\n      await this.#frame.browsingContext.close(options?.runBeforeUnload);\n    } catch {\n      return;\n    }\n  }\n\n  override async reload(\n    options: WaitForOptions = {}\n  ): Promise<BidiHTTPResponse | null> {\n    const [response] = await Promise.all([\n      this.#frame.waitForNavigation(options),\n      this.#frame.browsingContext.reload(),\n    ]).catch(\n      rewriteNavigationError(\n        this.url(),\n        options.timeout ?? this._timeoutSettings.navigationTimeout()\n      )\n    );\n    return response;\n  }\n\n  override setDefaultNavigationTimeout(timeout: number): void {\n    this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n  }\n\n  override setDefaultTimeout(timeout: number): void {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n\n  override getDefaultTimeout(): number {\n    return this._timeoutSettings.timeout();\n  }\n\n  override isJavaScriptEnabled(): boolean {\n    return this.#cdpEmulationManager.javascriptEnabled;\n  }\n\n  override async setGeolocation(options: GeolocationOptions): Promise<void> {\n    return await this.#cdpEmulationManager.setGeolocation(options);\n  }\n\n  override async setJavaScriptEnabled(enabled: boolean): Promise<void> {\n    return await this.#cdpEmulationManager.setJavaScriptEnabled(enabled);\n  }\n\n  override async emulateMediaType(type?: string): Promise<void> {\n    return await this.#cdpEmulationManager.emulateMediaType(type);\n  }\n\n  override async emulateCPUThrottling(factor: number | null): Promise<void> {\n    return await this.#cdpEmulationManager.emulateCPUThrottling(factor);\n  }\n\n  override async emulateMediaFeatures(\n    features?: MediaFeature[]\n  ): Promise<void> {\n    return await this.#cdpEmulationManager.emulateMediaFeatures(features);\n  }\n\n  override async emulateTimezone(timezoneId?: string): Promise<void> {\n    return await this.#cdpEmulationManager.emulateTimezone(timezoneId);\n  }\n\n  override async emulateIdleState(overrides?: {\n    isUserActive: boolean;\n    isScreenUnlocked: boolean;\n  }): Promise<void> {\n    return await this.#cdpEmulationManager.emulateIdleState(overrides);\n  }\n\n  override async emulateVisionDeficiency(\n    type?: Protocol.Emulation.SetEmulatedVisionDeficiencyRequest['type']\n  ): Promise<void> {\n    return await this.#cdpEmulationManager.emulateVisionDeficiency(type);\n  }\n\n  override async setViewport(viewport: Viewport): Promise<void> {\n    if (!this.browser().cdpSupported) {\n      await this.#frame.browsingContext.setViewport({\n        viewport:\n          viewport.width && viewport.height\n            ? {\n                width: viewport.width,\n                height: viewport.height,\n              }\n            : null,\n        devicePixelRatio: viewport.deviceScaleFactor\n          ? viewport.deviceScaleFactor\n          : null,\n      });\n      this.#viewport = viewport;\n      return;\n    }\n    const needsReload =\n      await this.#cdpEmulationManager.emulateViewport(viewport);\n    this.#viewport = viewport;\n    if (needsReload) {\n      await this.reload();\n    }\n  }\n\n  override viewport(): Viewport | null {\n    return this.#viewport;\n  }\n\n  override async pdf(options: PDFOptions = {}): Promise<Buffer> {\n    const {timeout: ms = this._timeoutSettings.timeout(), path = undefined} =\n      options;\n    const {\n      printBackground: background,\n      margin,\n      landscape,\n      width,\n      height,\n      pageRanges: ranges,\n      scale,\n      preferCSSPageSize,\n    } = parsePDFOptions(options, 'cm');\n    const pageRanges = ranges ? ranges.split(', ') : [];\n\n    await firstValueFrom(\n      from(\n        this.mainFrame()\n          .isolatedRealm()\n          .evaluate(() => {\n            return document.fonts.ready;\n          })\n      ).pipe(raceWith(timeout(ms)))\n    );\n\n    const data = await firstValueFrom(\n      from(\n        this.#frame.browsingContext.print({\n          background,\n          margin,\n          orientation: landscape ? 'landscape' : 'portrait',\n          page: {\n            width,\n            height,\n          },\n          pageRanges,\n          scale,\n          shrinkToFit: !preferCSSPageSize,\n        })\n      ).pipe(raceWith(timeout(ms)))\n    );\n\n    const buffer = Buffer.from(data, 'base64');\n\n    await this._maybeWriteBufferToFile(path, buffer);\n\n    return buffer;\n  }\n\n  override async createPDFStream(\n    options?: PDFOptions | undefined\n  ): Promise<ReadableStream<Uint8Array>> {\n    const buffer = await this.pdf(options);\n\n    return new ReadableStream({\n      start(controller) {\n        controller.enqueue(buffer);\n        controller.close();\n      },\n    });\n  }\n\n  override async _screenshot(\n    options: Readonly<ScreenshotOptions>\n  ): Promise<string> {\n    const {clip, type, captureBeyondViewport, quality} = options;\n    if (options.omitBackground !== undefined && options.omitBackground) {\n      throw new UnsupportedOperation(`BiDi does not support 'omitBackground'.`);\n    }\n    if (options.optimizeForSpeed !== undefined && options.optimizeForSpeed) {\n      throw new UnsupportedOperation(\n        `BiDi does not support 'optimizeForSpeed'.`\n      );\n    }\n    if (options.fromSurface !== undefined && !options.fromSurface) {\n      throw new UnsupportedOperation(`BiDi does not support 'fromSurface'.`);\n    }\n    if (clip !== undefined && clip.scale !== undefined && clip.scale !== 1) {\n      throw new UnsupportedOperation(\n        `BiDi does not support 'scale' in 'clip'.`\n      );\n    }\n\n    let box: BoundingBox | undefined;\n    if (clip) {\n      if (captureBeyondViewport) {\n        box = clip;\n      } else {\n        // The clip is always with respect to the document coordinates, so we\n        // need to convert this to viewport coordinates when we aren't capturing\n        // beyond the viewport.\n        const [pageLeft, pageTop] = await this.evaluate(() => {\n          if (!window.visualViewport) {\n            throw new Error('window.visualViewport is not supported.');\n          }\n          return [\n            window.visualViewport.pageLeft,\n            window.visualViewport.pageTop,\n          ] as const;\n        });\n        box = {\n          ...clip,\n          x: clip.x - pageLeft,\n          y: clip.y - pageTop,\n        };\n      }\n    }\n\n    const data = await this.#frame.browsingContext.captureScreenshot({\n      origin: captureBeyondViewport ? 'document' : 'viewport',\n      format: {\n        type: `image/${type}`,\n        ...(quality !== undefined ? {quality: quality / 100} : {}),\n      },\n      ...(box ? {clip: {type: 'box', ...box}} : {}),\n    });\n    return data;\n  }\n\n  override async createCDPSession(): Promise<CDPSession> {\n    return await this.#frame.createCDPSession();\n  }\n\n  override async bringToFront(): Promise<void> {\n    await this.#frame.browsingContext.activate();\n  }\n\n  override async evaluateOnNewDocument<\n    Params extends unknown[],\n    Func extends (...args: Params) => unknown = (...args: Params) => unknown,\n  >(\n    pageFunction: Func | string,\n    ...args: Params\n  ): Promise<NewDocumentScriptEvaluation> {\n    const expression = evaluationExpression(pageFunction, ...args);\n    const script =\n      await this.#frame.browsingContext.addPreloadScript(expression);\n\n    return {identifier: script};\n  }\n\n  override async removeScriptToEvaluateOnNewDocument(\n    id: string\n  ): Promise<void> {\n    await this.#frame.browsingContext.removePreloadScript(id);\n  }\n\n  override async exposeFunction<Args extends unknown[], Ret>(\n    name: string,\n    pptrFunction:\n      | ((...args: Args) => Awaitable<Ret>)\n      | {default: (...args: Args) => Awaitable<Ret>}\n  ): Promise<void> {\n    return await this.mainFrame().exposeFunction(\n      name,\n      'default' in pptrFunction ? pptrFunction.default : pptrFunction\n    );\n  }\n\n  override isDragInterceptionEnabled(): boolean {\n    return false;\n  }\n\n  override async setCacheEnabled(enabled?: boolean): Promise<void> {\n    // TODO: handle CDP-specific cases such as mprach.\n    await this._client().send('Network.setCacheDisabled', {\n      cacheDisabled: !enabled,\n    });\n  }\n\n  override async cookies(...urls: string[]): Promise<Cookie[]> {\n    const normalizedUrls = (urls.length ? urls : [this.url()]).map(url => {\n      return new URL(url);\n    });\n\n    const cookies = await this.#frame.browsingContext.getCookies();\n    return cookies\n      .map(cookie => {\n        return bidiToPuppeteerCookie(cookie);\n      })\n      .filter(cookie => {\n        return normalizedUrls.some(url => {\n          return testUrlMatchCookie(cookie, url);\n        });\n      });\n  }\n\n  override isServiceWorkerBypassed(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override target(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override waitForFileChooser(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override workers(): BidiWebWorker[] {\n    return [...this.#workers];\n  }\n\n  #userInterception?: string;\n  override async setRequestInterception(enable: boolean): Promise<void> {\n    this.#userInterception = await this.#toggleInterception(\n      [Bidi.Network.InterceptPhase.BeforeRequestSent],\n      this.#userInterception,\n      enable\n    );\n  }\n\n  /**\n   * @internal\n   */\n  _extraHTTPHeaders: Record<string, string> = {};\n  #extraHeadersInterception?: string;\n  override async setExtraHTTPHeaders(\n    headers: Record<string, string>\n  ): Promise<void> {\n    const extraHTTPHeaders: Record<string, string> = {};\n    for (const [key, value] of Object.entries(headers)) {\n      assert(\n        isString(value),\n        `Expected value of header \"${key}\" to be String, but \"${typeof value}\" is found.`\n      );\n      extraHTTPHeaders[key.toLowerCase()] = value;\n    }\n    this._extraHTTPHeaders = extraHTTPHeaders;\n\n    this.#extraHeadersInterception = await this.#toggleInterception(\n      [Bidi.Network.InterceptPhase.BeforeRequestSent],\n      this.#extraHeadersInterception,\n      Boolean(Object.keys(this._extraHTTPHeaders).length)\n    );\n  }\n\n  /**\n   * @internal\n   */\n  _credentials: Credentials | null = null;\n  #authInterception?: string;\n  override async authenticate(credentials: Credentials | null): Promise<void> {\n    this.#authInterception = await this.#toggleInterception(\n      [Bidi.Network.InterceptPhase.AuthRequired],\n      this.#authInterception,\n      Boolean(credentials)\n    );\n\n    this._credentials = credentials;\n  }\n\n  async #toggleInterception(\n    phases: [Bidi.Network.InterceptPhase, ...Bidi.Network.InterceptPhase[]],\n    interception: string | undefined,\n    expected: boolean\n  ): Promise<string | undefined> {\n    if (expected && !interception) {\n      return await this.#frame.browsingContext.addIntercept({\n        phases,\n      });\n    } else if (!expected && interception) {\n      await this.#frame.browsingContext.userContext.browser.removeIntercept(\n        interception\n      );\n      return;\n    }\n    return interception;\n  }\n\n  override setDragInterception(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override setBypassServiceWorker(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override setOfflineMode(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override emulateNetworkConditions(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override async setCookie(...cookies: CookieParam[]): Promise<void> {\n    const pageURL = this.url();\n    const pageUrlStartsWithHTTP = pageURL.startsWith('http');\n    for (const cookie of cookies) {\n      let cookieUrl = cookie.url || '';\n      if (!cookieUrl && pageUrlStartsWithHTTP) {\n        cookieUrl = pageURL;\n      }\n      assert(\n        cookieUrl !== 'about:blank',\n        `Blank page can not have cookie \"${cookie.name}\"`\n      );\n      assert(\n        !String.prototype.startsWith.call(cookieUrl || '', 'data:'),\n        `Data URL page can not have cookie \"${cookie.name}\"`\n      );\n\n      const normalizedUrl = URL.canParse(cookieUrl)\n        ? new URL(cookieUrl)\n        : undefined;\n\n      const domain = cookie.domain ?? normalizedUrl?.hostname;\n      assert(\n        domain !== undefined,\n        `At least one of the url and domain needs to be specified`\n      );\n\n      const bidiCookie: Bidi.Storage.PartialCookie = {\n        domain: domain,\n        name: cookie.name,\n        value: {\n          type: 'string',\n          value: cookie.value,\n        },\n        ...(cookie.path !== undefined ? {path: cookie.path} : {}),\n        ...(cookie.httpOnly !== undefined ? {httpOnly: cookie.httpOnly} : {}),\n        ...(cookie.secure !== undefined ? {secure: cookie.secure} : {}),\n        ...(cookie.sameSite !== undefined\n          ? {sameSite: convertCookiesSameSiteCdpToBiDi(cookie.sameSite)}\n          : {}),\n        ...(cookie.expires !== undefined ? {expiry: cookie.expires} : {}),\n        // Chrome-specific properties.\n        ...cdpSpecificCookiePropertiesFromPuppeteerToBidi(\n          cookie,\n          'sameParty',\n          'sourceScheme',\n          'priority',\n          'url'\n        ),\n      };\n\n      if (cookie.partitionKey !== undefined) {\n        await this.browserContext().userContext.setCookie(\n          bidiCookie,\n          cookie.partitionKey\n        );\n      } else {\n        await this.#frame.browsingContext.setCookie(bidiCookie);\n      }\n    }\n  }\n\n  override async deleteCookie(\n    ...cookies: DeleteCookiesRequest[]\n  ): Promise<void> {\n    await Promise.all(\n      cookies.map(async deleteCookieRequest => {\n        const cookieUrl = deleteCookieRequest.url ?? this.url();\n        const normalizedUrl = URL.canParse(cookieUrl)\n          ? new URL(cookieUrl)\n          : undefined;\n\n        const domain = deleteCookieRequest.domain ?? normalizedUrl?.hostname;\n        assert(\n          domain !== undefined,\n          `At least one of the url and domain needs to be specified`\n        );\n\n        const filter = {\n          domain: domain,\n          name: deleteCookieRequest.name,\n          ...(deleteCookieRequest.path !== undefined\n            ? {path: deleteCookieRequest.path}\n            : {}),\n        };\n        await this.#frame.browsingContext.deleteCookie(filter);\n      })\n    );\n  }\n\n  override async removeExposedFunction(name: string): Promise<void> {\n    await this.#frame.removeExposedFunction(name);\n  }\n\n  override metrics(): never {\n    throw new UnsupportedOperation();\n  }\n\n  override async goBack(\n    options: WaitForOptions = {}\n  ): Promise<HTTPResponse | null> {\n    return await this.#go(-1, options);\n  }\n\n  override async goForward(\n    options: WaitForOptions = {}\n  ): Promise<HTTPResponse | null> {\n    return await this.#go(1, options);\n  }\n\n  async #go(\n    delta: number,\n    options: WaitForOptions\n  ): Promise<HTTPResponse | null> {\n    try {\n      const [response] = await Promise.all([\n        this.waitForNavigation(options),\n        this.#frame.browsingContext.traverseHistory(delta),\n      ]);\n      return response;\n    } catch (error) {\n      // TODO: waitForNavigation should be cancelled if an error happens.\n      if (isErrorLike(error)) {\n        if (error.message.includes('no such history entry')) {\n          return null;\n        }\n      }\n      throw error;\n    }\n  }\n\n  override waitForDevicePrompt(): never {\n    throw new UnsupportedOperation();\n  }\n}\n\nfunction evaluationExpression(fun: Function | string, ...args: unknown[]) {\n  return `() => {${evaluationString(fun, ...args)}}`;\n}\n\n/**\n * Check domains match.\n * According to cookies spec, this check should match subdomains as well, but CDP\n * implementation does not do that, so this method matches only the exact domains, not\n * what is written in the spec:\n * https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.3\n */\nfunction testUrlMatchCookieHostname(\n  cookie: Cookie,\n  normalizedUrl: URL\n): boolean {\n  const cookieDomain = cookie.domain.toLowerCase();\n  const urlHostname = normalizedUrl.hostname.toLowerCase();\n  return cookieDomain === urlHostname;\n}\n\n/**\n * Check paths match.\n * Spec: https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.4\n */\nfunction testUrlMatchCookiePath(cookie: Cookie, normalizedUrl: URL): boolean {\n  const uriPath = normalizedUrl.pathname;\n  const cookiePath = cookie.path;\n\n  if (uriPath === cookiePath) {\n    // The cookie-path and the request-path are identical.\n    return true;\n  }\n  if (uriPath.startsWith(cookiePath)) {\n    // The cookie-path is a prefix of the request-path.\n    if (cookiePath.endsWith('/')) {\n      // The last character of the cookie-path is %x2F (\"/\").\n      return true;\n    }\n    if (uriPath[cookiePath.length] === '/') {\n      // The first character of the request-path that is not included in the cookie-path\n      // is a %x2F (\"/\") character.\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Checks the cookie matches the URL according to the spec:\n */\nfunction testUrlMatchCookie(cookie: Cookie, url: URL): boolean {\n  const normalizedUrl = new URL(url);\n  assert(cookie !== undefined);\n  if (!testUrlMatchCookieHostname(cookie, normalizedUrl)) {\n    return false;\n  }\n  return testUrlMatchCookiePath(cookie, normalizedUrl);\n}\n\nfunction bidiToPuppeteerCookie(bidiCookie: Bidi.Network.Cookie): Cookie {\n  return {\n    name: bidiCookie.name,\n    // Presents binary value as base64 string.\n    value: bidiCookie.value.value,\n    domain: bidiCookie.domain,\n    path: bidiCookie.path,\n    size: bidiCookie.size,\n    httpOnly: bidiCookie.httpOnly,\n    secure: bidiCookie.secure,\n    sameSite: convertCookiesSameSiteBiDiToCdp(bidiCookie.sameSite),\n    expires: bidiCookie.expiry ?? -1,\n    session: bidiCookie.expiry === undefined || bidiCookie.expiry <= 0,\n    // Extending with CDP-specific properties with `goog:` prefix.\n    ...cdpSpecificCookiePropertiesFromBidiToPuppeteer(\n      bidiCookie,\n      'sameParty',\n      'sourceScheme',\n      'partitionKey',\n      'partitionKeyOpaque',\n      'priority'\n    ),\n  };\n}\n\nconst CDP_SPECIFIC_PREFIX = 'goog:';\n\n/**\n * Gets CDP-specific properties from the BiDi cookie and returns them as a new object.\n */\nfunction cdpSpecificCookiePropertiesFromBidiToPuppeteer(\n  bidiCookie: Bidi.Network.Cookie,\n  ...propertyNames: Array<keyof Cookie>\n): Partial<Cookie> {\n  const result: Partial<Cookie> = {};\n  for (const property of propertyNames) {\n    if (bidiCookie[CDP_SPECIFIC_PREFIX + property] !== undefined) {\n      result[property] = bidiCookie[CDP_SPECIFIC_PREFIX + property];\n    }\n  }\n  return result;\n}\n\n/**\n * Gets CDP-specific properties from the cookie, adds CDP-specific prefixes and returns\n * them as a new object which can be used in BiDi.\n */\nfunction cdpSpecificCookiePropertiesFromPuppeteerToBidi(\n  cookieParam: CookieParam,\n  ...propertyNames: Array<keyof CookieParam>\n): Record<string, unknown> {\n  const result: Record<string, unknown> = {};\n  for (const property of propertyNames) {\n    if (cookieParam[property] !== undefined) {\n      result[CDP_SPECIFIC_PREFIX + property] = cookieParam[property];\n    }\n  }\n  return result;\n}\n\nfunction convertCookiesSameSiteBiDiToCdp(\n  sameSite: Bidi.Network.SameSite | undefined\n): CookieSameSite {\n  return sameSite === 'strict' ? 'Strict' : sameSite === 'lax' ? 'Lax' : 'None';\n}\n\nfunction convertCookiesSameSiteCdpToBiDi(\n  sameSite: CookieSameSite | undefined\n): Bidi.Network.SameSite {\n  return sameSite === 'Strict'\n    ? Bidi.Network.SameSite.Strict\n    : sameSite === 'Lax'\n      ? Bidi.Network.SameSite.Lax\n      : Bidi.Network.SameSite.None;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}