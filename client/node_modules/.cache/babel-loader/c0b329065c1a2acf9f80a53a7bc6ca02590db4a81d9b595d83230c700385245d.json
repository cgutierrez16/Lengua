{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PipeTransport = void 0;\nconst EventEmitter_js_1 = require(\"../common/EventEmitter.js\");\nconst util_js_1 = require(\"../common/util.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst disposable_js_1 = require(\"../util/disposable.js\");\n/**\n * @internal\n */\nclass PipeTransport {\n  #pipeWrite;\n  #subscriptions = new disposable_js_1.DisposableStack();\n  #isClosed = false;\n  #pendingMessage = '';\n  onclose;\n  onmessage;\n  constructor(pipeWrite, pipeRead) {\n    this.#pipeWrite = pipeWrite;\n    this.#subscriptions.use(new EventEmitter_js_1.EventSubscription(pipeRead, 'data', buffer => {\n      return this.#dispatch(buffer);\n    }));\n    this.#subscriptions.use(new EventEmitter_js_1.EventSubscription(pipeRead, 'close', () => {\n      if (this.onclose) {\n        this.onclose.call(null);\n      }\n    }));\n    this.#subscriptions.use(new EventEmitter_js_1.EventSubscription(pipeRead, 'error', util_js_1.debugError));\n    this.#subscriptions.use(new EventEmitter_js_1.EventSubscription(pipeWrite, 'error', util_js_1.debugError));\n  }\n  send(message) {\n    (0, assert_js_1.assert)(!this.#isClosed, '`PipeTransport` is closed.');\n    this.#pipeWrite.write(message);\n    this.#pipeWrite.write('\\0');\n  }\n  #dispatch(buffer) {\n    (0, assert_js_1.assert)(!this.#isClosed, '`PipeTransport` is closed.');\n    let end = buffer.indexOf('\\0');\n    if (end === -1) {\n      this.#pendingMessage += buffer.toString();\n      return;\n    }\n    const message = this.#pendingMessage + buffer.toString(undefined, 0, end);\n    if (this.onmessage) {\n      this.onmessage.call(null, message);\n    }\n    let start = end + 1;\n    end = buffer.indexOf('\\0', start);\n    while (end !== -1) {\n      if (this.onmessage) {\n        this.onmessage.call(null, buffer.toString(undefined, start, end));\n      }\n      start = end + 1;\n      end = buffer.indexOf('\\0', start);\n    }\n    this.#pendingMessage = buffer.toString(undefined, start);\n  }\n  close() {\n    this.#isClosed = true;\n    this.#subscriptions.dispose();\n  }\n}\nexports.PipeTransport = PipeTransport;","map":{"version":3,"names":["EventEmitter_js_1","require","util_js_1","assert_js_1","disposable_js_1","PipeTransport","pipeWrite","subscriptions","DisposableStack","isClosed","pendingMessage","onclose","onmessage","constructor","pipeRead","use","EventSubscription","buffer","dispatch","call","debugError","send","message","assert","write","#dispatch","end","indexOf","toString","undefined","start","close","dispose","exports"],"sources":["/Users/carlosgutierrez/Documents/React/spanish/node_modules/puppeteer-core/src/node/PipeTransport.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2018 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport type {ConnectionTransport} from '../common/ConnectionTransport.js';\nimport {EventSubscription} from '../common/EventEmitter.js';\nimport {debugError} from '../common/util.js';\nimport {assert} from '../util/assert.js';\nimport {DisposableStack} from '../util/disposable.js';\n\n/**\n * @internal\n */\nexport class PipeTransport implements ConnectionTransport {\n  #pipeWrite: NodeJS.WritableStream;\n  #subscriptions = new DisposableStack();\n\n  #isClosed = false;\n  #pendingMessage = '';\n\n  onclose?: () => void;\n  onmessage?: (value: string) => void;\n\n  constructor(\n    pipeWrite: NodeJS.WritableStream,\n    pipeRead: NodeJS.ReadableStream\n  ) {\n    this.#pipeWrite = pipeWrite;\n    this.#subscriptions.use(\n      new EventSubscription(pipeRead, 'data', (buffer: Buffer) => {\n        return this.#dispatch(buffer);\n      })\n    );\n    this.#subscriptions.use(\n      new EventSubscription(pipeRead, 'close', () => {\n        if (this.onclose) {\n          this.onclose.call(null);\n        }\n      })\n    );\n    this.#subscriptions.use(\n      new EventSubscription(pipeRead, 'error', debugError)\n    );\n    this.#subscriptions.use(\n      new EventSubscription(pipeWrite, 'error', debugError)\n    );\n  }\n\n  send(message: string): void {\n    assert(!this.#isClosed, '`PipeTransport` is closed.');\n\n    this.#pipeWrite.write(message);\n    this.#pipeWrite.write('\\0');\n  }\n\n  #dispatch(buffer: Buffer): void {\n    assert(!this.#isClosed, '`PipeTransport` is closed.');\n\n    let end = buffer.indexOf('\\0');\n    if (end === -1) {\n      this.#pendingMessage += buffer.toString();\n      return;\n    }\n    const message = this.#pendingMessage + buffer.toString(undefined, 0, end);\n    if (this.onmessage) {\n      this.onmessage.call(null, message);\n    }\n\n    let start = end + 1;\n    end = buffer.indexOf('\\0', start);\n    while (end !== -1) {\n      if (this.onmessage) {\n        this.onmessage.call(null, buffer.toString(undefined, start, end));\n      }\n      start = end + 1;\n      end = buffer.indexOf('\\0', start);\n    }\n    this.#pendingMessage = buffer.toString(undefined, start);\n  }\n\n  close(): void {\n    this.#isClosed = true;\n    this.#subscriptions.dispose();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}